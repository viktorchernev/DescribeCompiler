<!DOCTYPE html>
<html lang="en-US" xmlns:og="http://opengraphprotocol.org/schema/" xmlns:fb="http://www.facebook.com/2008/fbml">
<head><meta charset="UTF-8"><script>if(navigator.userAgent.match(/MSIE|Internet Explorer/i)||navigator.userAgent.match(/Trident\/7\..*?rv:11/i)){var href=document.location.href;if(!href.match(/[?&]nowprocket/)){if(href.indexOf("?")==-1){if(href.indexOf("#")==-1){document.location.href=href+"?nowprocket=1"}else{document.location.href=href.replace("#","?nowprocket=1#")}}else{if(href.indexOf("#")==-1){document.location.href=href+"&nowprocket=1"}else{document.location.href=href.replace("#","&nowprocket=1#")}}}}</script><script>class RocketLazyLoadScripts{constructor(){this.triggerEvents=["keydown","mousedown","mousemove","touchmove","touchstart","touchend","wheel"],this.userEventHandler=this._triggerListener.bind(this),this.touchStartHandler=this._onTouchStart.bind(this),this.touchMoveHandler=this._onTouchMove.bind(this),this.touchEndHandler=this._onTouchEnd.bind(this),this.clickHandler=this._onClick.bind(this),this.interceptedClicks=[],window.addEventListener("pageshow",(e=>{this.persisted=e.persisted})),window.addEventListener("DOMContentLoaded",(()=>{this._preconnect3rdParties()})),this.delayedScripts={normal:[],async:[],defer:[]},this.allJQueries=[]}_addUserInteractionListener(e){document.hidden?e._triggerListener():(this.triggerEvents.forEach((t=>window.addEventListener(t,e.userEventHandler,{passive:!0}))),window.addEventListener("touchstart",e.touchStartHandler,{passive:!0}),window.addEventListener("mousedown",e.touchStartHandler),document.addEventListener("visibilitychange",e.userEventHandler))}_removeUserInteractionListener(){this.triggerEvents.forEach((e=>window.removeEventListener(e,this.userEventHandler,{passive:!0}))),document.removeEventListener("visibilitychange",this.userEventHandler)}_onTouchStart(e){"HTML"!==e.target.tagName&&(window.addEventListener("touchend",this.touchEndHandler),window.addEventListener("mouseup",this.touchEndHandler),window.addEventListener("touchmove",this.touchMoveHandler,{passive:!0}),window.addEventListener("mousemove",this.touchMoveHandler),e.target.addEventListener("click",this.clickHandler),this._renameDOMAttribute(e.target,"onclick","rocket-onclick"))}_onTouchMove(e){window.removeEventListener("touchend",this.touchEndHandler),window.removeEventListener("mouseup",this.touchEndHandler),window.removeEventListener("touchmove",this.touchMoveHandler,{passive:!0}),window.removeEventListener("mousemove",this.touchMoveHandler),e.target.removeEventListener("click",this.clickHandler),this._renameDOMAttribute(e.target,"rocket-onclick","onclick")}_onTouchEnd(e){window.removeEventListener("touchend",this.touchEndHandler),window.removeEventListener("mouseup",this.touchEndHandler),window.removeEventListener("touchmove",this.touchMoveHandler,{passive:!0}),window.removeEventListener("mousemove",this.touchMoveHandler)}_onClick(e){e.target.removeEventListener("click",this.clickHandler),this._renameDOMAttribute(e.target,"rocket-onclick","onclick"),this.interceptedClicks.push(e),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}_replayClicks(){window.removeEventListener("touchstart",this.touchStartHandler,{passive:!0}),window.removeEventListener("mousedown",this.touchStartHandler),this.interceptedClicks.forEach((e=>{e.target.dispatchEvent(new MouseEvent("click",{view:e.view,bubbles:!0,cancelable:!0}))}))}_renameDOMAttribute(e,t,n){e.hasAttribute&&e.hasAttribute(t)&&(event.target.setAttribute(n,event.target.getAttribute(t)),event.target.removeAttribute(t))}_triggerListener(){this._removeUserInteractionListener(this),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",this._loadEverythingNow.bind(this)):this._loadEverythingNow()}_preconnect3rdParties(){let e=[];document.querySelectorAll("script[type=rocketlazyloadscript]").forEach((t=>{if(t.hasAttribute("src")){const n=new URL(t.src).origin;n!==location.origin&&e.push({src:n,crossOrigin:t.crossOrigin||"module"===t.getAttribute("data-rocket-type")})}})),e=[...new Map(e.map((e=>[JSON.stringify(e),e]))).values()],this._batchInjectResourceHints(e,"preconnect")}async _loadEverythingNow(){this.lastBreath=Date.now(),this._delayEventListeners(),this._delayJQueryReady(this),this._handleDocumentWrite(),this._registerAllDelayedScripts(),this._preloadAllScripts(),await this._loadScriptsFromList(this.delayedScripts.normal),await this._loadScriptsFromList(this.delayedScripts.defer),await this._loadScriptsFromList(this.delayedScripts.async);try{await this._triggerDOMContentLoaded(),await this._triggerWindowLoad()}catch(e){}window.dispatchEvent(new Event("rocket-allScriptsLoaded")),this._replayClicks()}_registerAllDelayedScripts(){document.querySelectorAll("script[type=rocketlazyloadscript]").forEach((e=>{e.hasAttribute("src")?e.hasAttribute("async")&&!1!==e.async?this.delayedScripts.async.push(e):e.hasAttribute("defer")&&!1!==e.defer||"module"===e.getAttribute("data-rocket-type")?this.delayedScripts.defer.push(e):this.delayedScripts.normal.push(e):this.delayedScripts.normal.push(e)}))}async _transformScript(e){return await this._littleBreath(),new Promise((t=>{const n=document.createElement("script");[...e.attributes].forEach((e=>{let t=e.nodeName;"type"!==t&&("data-rocket-type"===t&&(t="type"),n.setAttribute(t,e.nodeValue))})),e.hasAttribute("src")?(n.addEventListener("load",t),n.addEventListener("error",t)):(n.text=e.text,t());try{e.parentNode.replaceChild(n,e)}catch(e){t()}}))}async _loadScriptsFromList(e){const t=e.shift();return t?(await this._transformScript(t),this._loadScriptsFromList(e)):Promise.resolve()}_preloadAllScripts(){this._batchInjectResourceHints([...this.delayedScripts.normal,...this.delayedScripts.defer,...this.delayedScripts.async],"preload")}_batchInjectResourceHints(e,t){var n=document.createDocumentFragment();e.forEach((e=>{if(e.src){const i=document.createElement("link");i.href=e.src,i.rel=t,"preconnect"!==t&&(i.as="script"),e.getAttribute&&"module"===e.getAttribute("data-rocket-type")&&(i.crossOrigin=!0),e.crossOrigin&&(i.crossOrigin=e.crossOrigin),n.appendChild(i)}})),document.head.appendChild(n)}_delayEventListeners(){let e={};function t(t,n){!function(t){function n(n){return e[t].eventsToRewrite.indexOf(n)>=0?"rocket-"+n:n}e[t]||(e[t]={originalFunctions:{add:t.addEventListener,remove:t.removeEventListener},eventsToRewrite:[]},t.addEventListener=function(){arguments[0]=n(arguments[0]),e[t].originalFunctions.add.apply(t,arguments)},t.removeEventListener=function(){arguments[0]=n(arguments[0]),e[t].originalFunctions.remove.apply(t,arguments)})}(t),e[t].eventsToRewrite.push(n)}function n(e,t){let n=e[t];Object.defineProperty(e,t,{get:()=>n||function(){},set(i){e["rocket"+t]=n=i}})}t(document,"DOMContentLoaded"),t(window,"DOMContentLoaded"),t(window,"load"),t(window,"pageshow"),t(document,"readystatechange"),n(document,"onreadystatechange"),n(window,"onload"),n(window,"onpageshow")}_delayJQueryReady(e){let t=window.jQuery;Object.defineProperty(window,"jQuery",{get:()=>t,set(n){if(n&&n.fn&&!e.allJQueries.includes(n)){n.fn.ready=n.fn.init.prototype.ready=function(t){e.domReadyFired?t.bind(document)(n):document.addEventListener("rocket-DOMContentLoaded",(()=>t.bind(document)(n)))};const t=n.fn.on;n.fn.on=n.fn.init.prototype.on=function(){if(this[0]===window){function e(e){return e.split(" ").map((e=>"load"===e||0===e.indexOf("load.")?"rocket-jquery-load":e)).join(" ")}"string"==typeof arguments[0]||arguments[0]instanceof String?arguments[0]=e(arguments[0]):"object"==typeof arguments[0]&&Object.keys(arguments[0]).forEach((t=>{delete Object.assign(arguments[0],{[e(t)]:arguments[0][t]})[t]}))}return t.apply(this,arguments),this},e.allJQueries.push(n)}t=n}})}async _triggerDOMContentLoaded(){this.domReadyFired=!0,await this._littleBreath(),document.dispatchEvent(new Event("rocket-DOMContentLoaded")),await this._littleBreath(),window.dispatchEvent(new Event("rocket-DOMContentLoaded")),await this._littleBreath(),document.dispatchEvent(new Event("rocket-readystatechange")),await this._littleBreath(),document.rocketonreadystatechange&&document.rocketonreadystatechange()}async _triggerWindowLoad(){await this._littleBreath(),window.dispatchEvent(new Event("rocket-load")),await this._littleBreath(),window.rocketonload&&window.rocketonload(),await this._littleBreath(),this.allJQueries.forEach((e=>e(window).trigger("rocket-jquery-load"))),await this._littleBreath();const e=new Event("rocket-pageshow");e.persisted=this.persisted,window.dispatchEvent(e),await this._littleBreath(),window.rocketonpageshow&&window.rocketonpageshow({persisted:this.persisted})}_handleDocumentWrite(){const e=new Map;document.write=document.writeln=function(t){const n=document.currentScript,i=document.createRange(),r=n.parentElement;let o=e.get(n);void 0===o&&(o=n.nextSibling,e.set(n,o));const s=document.createDocumentFragment();i.setStart(s,0),s.appendChild(i.createContextualFragment(t)),r.insertBefore(s,o)}}async _littleBreath(){Date.now()-this.lastBreath>45&&(await this._requestAnimFrame(),this.lastBreath=Date.now())}async _requestAnimFrame(){return document.hidden?new Promise((e=>setTimeout(e))):new Promise((e=>requestAnimationFrame(e)))}static run(){const e=new RocketLazyLoadScripts;e._addUserInteractionListener(e)}}RocketLazyLoadScripts.run();</script>
<title>The ANTLR Mega Tutorial</title>
<link rel="profile" href="https://gmpg.org/xfn/11">
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />

<script data-cfasync="false" data-pagespeed-no-defer>
	var gtm4wp_datalayer_name = "dataLayer";
	var dataLayer = dataLayer || [];
</script>


<meta name="description" content="The definitive ANTLR mega tutorial on ANTLR4. Learn everything you need to know; with code in JavaScript, Python, Java and C#." />
<link rel="canonical" href="https://tomassetti.me/antlr-mega-tutorial/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="The ANTLR Mega Tutorial" />
<meta property="og:description" content="The definitive ANTLR mega tutorial on ANTLR4. Learn everything you need to know; with code in JavaScript, Python, Java and C#." />
<meta property="og:url" content="https://tomassetti.me/antlr-mega-tutorial/" />
<meta property="og:site_name" content="Strumenta" />
<meta property="article:publisher" content="https://www.facebook.com/tomassetticonsultant/" />
<meta property="article:published_time" content="2017-03-08T11:28:32+00:00" />
<meta property="article:modified_time" content="2022-03-23T16:49:41+00:00" />
<meta property="og:image" content="https://tomassetti.me/wp-content/uploads/2017/03/Link-shares-FB-ANTLR-mega-tutorial.jpg" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:type" content="image/jpeg" />
<meta name="author" content="Gabriele Tomassetti" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://tomassetti.me/wp-content/uploads/2017/03/Link-shares-FB-ANTLR-mega-tutorial.jpg" />
<meta name="twitter:creator" content="@ftomasse" />
<meta name="twitter:site" content="@ftomasse" />
<meta name="twitter:label1" content="Written by" />
<meta name="twitter:data1" content="Gabriele Tomassetti" />
<meta name="twitter:label2" content="Est. reading time" />
<meta name="twitter:data2" content="68 minutes" />
<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://tomassetti.me/antlr-mega-tutorial/#article","isPartOf":{"@id":"https://tomassetti.me/antlr-mega-tutorial/"},"author":{"name":"Gabriele Tomassetti","@id":"https://tomassetti.me/#/schema/person/9d34d5e44624f1376e9614c2a25cf248"},"headline":"The ANTLR Mega Tutorial","datePublished":"2017-03-08T11:28:32+00:00","dateModified":"2022-03-23T16:49:41+00:00","mainEntityOfPage":{"@id":"https://tomassetti.me/antlr-mega-tutorial/"},"wordCount":12363,"publisher":{"@id":"https://tomassetti.me/#organization"},"image":{"@id":"https://tomassetti.me/antlr-mega-tutorial/#primaryimage"},"thumbnailUrl":"https://tomassetti.me/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial.jpg","keywords":["C#","Java","JavaScript","Python"],"articleSection":["ANTLR","Language Engineering","Parsing"],"inLanguage":"en-US"},{"@type":"WebPage","@id":"https://tomassetti.me/antlr-mega-tutorial/","url":"https://tomassetti.me/antlr-mega-tutorial/","name":"The ANTLR Mega Tutorial","isPartOf":{"@id":"https://tomassetti.me/#website"},"primaryImageOfPage":{"@id":"https://tomassetti.me/antlr-mega-tutorial/#primaryimage"},"image":{"@id":"https://tomassetti.me/antlr-mega-tutorial/#primaryimage"},"thumbnailUrl":"https://tomassetti.me/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial.jpg","datePublished":"2017-03-08T11:28:32+00:00","dateModified":"2022-03-23T16:49:41+00:00","description":"The definitive ANTLR mega tutorial on ANTLR4. Learn everything you need to know; with code in JavaScript, Python, Java and C#.","breadcrumb":{"@id":"https://tomassetti.me/antlr-mega-tutorial/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://tomassetti.me/antlr-mega-tutorial/"]}]},{"@type":"ImageObject","inLanguage":"en-US","@id":"https://tomassetti.me/antlr-mega-tutorial/#primaryimage","url":"https://tomassetti.me/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial.jpg","contentUrl":"https://tomassetti.me/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial.jpg","width":1024,"height":512,"caption":"ANTLR Mega Tutorial"},{"@type":"BreadcrumbList","@id":"https://tomassetti.me/antlr-mega-tutorial/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://tomassetti.me/"},{"@type":"ListItem","position":2,"name":"The ANTLR Mega Tutorial"}]},{"@type":"WebSite","@id":"https://tomassetti.me/#website","url":"https://tomassetti.me/","name":"Strumenta","description":"Tools to solve complex problems","publisher":{"@id":"https://tomassetti.me/#organization"},"potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://tomassetti.me/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"Organization","@id":"https://tomassetti.me/#organization","name":"Strumenta S.R.L.","url":"https://tomassetti.me/","logo":{"@type":"ImageObject","inLanguage":"en-US","@id":"https://tomassetti.me/#/schema/logo/image/","url":"https://tomassetti.me/wp-content/uploads/2018/08/Logo_Standard_nowriting_trasparente.png","contentUrl":"https://tomassetti.me/wp-content/uploads/2018/08/Logo_Standard_nowriting_trasparente.png","width":476,"height":821,"caption":"Strumenta S.R.L."},"image":{"@id":"https://tomassetti.me/#/schema/logo/image/"},"sameAs":["https://www.facebook.com/tomassetticonsultant/","https://twitter.com/ftomasse","https://www.linkedin.com/in/federicotomassetti/","https://www.youtube.com/channel/UC-d-doLMBYrzLbkkz23qMPA"]},{"@type":"Person","@id":"https://tomassetti.me/#/schema/person/9d34d5e44624f1376e9614c2a25cf248","name":"Gabriele Tomassetti","description":"I started developing software to make a football management simulation and never stopped. I love C# and like a whole lot of other languages.","url":"https://tomassetti.me/author/gtomassetti/"}]}</script>

<link rel="dns-prefetch" href="//stats.wp.com" />
<link rel="dns-prefetch" href="//v0.wordpress.com" />
<style id="wp-emoji-styles-inline-css" type="text/css">

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
</style>
<link rel="stylesheet" id="wp-block-library-css" href="https://tomassetti.me/wp-includes/css/dist/block-library/style.min.css?ver=6.4.3" type="text/css" media="all" />
<style id="wp-block-library-inline-css" type="text/css">
.has-text-align-justify{text-align:justify;}
</style>
<link rel="stylesheet" id="mediaelement-css" href="https://tomassetti.me/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css?ver=4.2.17" type="text/css" media="all" />
<link rel="stylesheet" id="wp-mediaelement-css" href="https://tomassetti.me/wp-includes/js/mediaelement/wp-mediaelement.min.css?ver=6.4.3" type="text/css" media="all" />
<style id="jetpack-sharing-buttons-style-inline-css" type="text/css">
.jetpack-sharing-buttons__services-list{display:flex;flex-direction:row;flex-wrap:wrap;gap:0;list-style-type:none;margin:5px;padding:0}.jetpack-sharing-buttons__services-list.has-small-icon-size{font-size:12px}.jetpack-sharing-buttons__services-list.has-normal-icon-size{font-size:16px}.jetpack-sharing-buttons__services-list.has-large-icon-size{font-size:24px}.jetpack-sharing-buttons__services-list.has-huge-icon-size{font-size:36px}@media print{.jetpack-sharing-buttons__services-list{display:none!important}}ul.jetpack-sharing-buttons__services-list.has-background{padding:1.25em 2.375em}
</style>
<link data-minify="1" rel="stylesheet" id="convertkit-broadcasts-css" href="https://tomassetti.me/wp-content/cache/min/1/wp-content/plugins/convertkit/resources/frontend/css/broadcasts.css?ver=1699350009" type="text/css" media="all" />
<link data-minify="1" rel="stylesheet" id="convertkit-button-css" href="https://tomassetti.me/wp-content/cache/min/1/wp-content/plugins/convertkit/resources/frontend/css/button.css?ver=1699350009" type="text/css" media="all" />
<link data-minify="1" rel="stylesheet" id="convertkit-form-css" href="https://tomassetti.me/wp-content/cache/min/1/wp-content/plugins/convertkit/resources/frontend/css/form.css?ver=1699350009" type="text/css" media="all" />
<style id="classic-theme-styles-inline-css" type="text/css">
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id="global-styles-inline-css" type="text/css">
body{--wp--preset--color--black: #d5b553;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #fff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--color--dark-grey: #68686A;--wp--preset--color--grey: #d8d8dA;--wp--preset--color--light-grey: #E8E8EA;--wp--preset--color--xlight-grey: #F8F8FA;--wp--preset--color--blue: #81AAB6;--wp--preset--color--light-blue: #81AAB6;--wp--preset--color--xlight-blue: #C1E2EB;--wp--preset--color--xxlight-blue: #EAF9FD;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flow > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-flow > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-flow > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-constrained > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-constrained > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width: var(--wp--style--global--content-size);margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignwide{max-width: var(--wp--style--global--wide-size);}body .is-layout-flex{display: flex;}body .is-layout-flex{flex-wrap: wrap;align-items: center;}body .is-layout-flex > *{margin: 0;}body .is-layout-grid{display: grid;}body .is-layout-grid > *{margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
.wp-block-navigation a:where(:not(.wp-element-button)){color: inherit;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
.wp-block-pullquote{font-size: 1.5em;line-height: 1.6;}
</style>
<link data-minify="1" rel="stylesheet" id="theme-init-css" href="https://tomassetti.me/wp-content/cache/min/1/wp-content/themes/strumenta/css/init.css?ver=1699350009" type="text/css" media="all" />
<link data-minify="1" rel="stylesheet" id="theme-grid-css" href="https://tomassetti.me/wp-content/cache/min/1/wp-content/themes/strumenta/css/grid.css?ver=1699350009" type="text/css" media="all" />
<link data-minify="1" rel="stylesheet" id="theme-fonts-css" href="https://tomassetti.me/wp-content/cache/min/1/wp-content/themes/strumenta/css/fonts.css?ver=1699350009" type="text/css" media="all" />
<link data-minify="1" rel="stylesheet" id="theme-style-css" href="https://tomassetti.me/wp-content/cache/min/1/wp-content/themes/strumenta/css/style.css?ver=1699350009" type="text/css" media="all" />
<link data-minify="1" rel="stylesheet" id="theme-responsive-css" href="https://tomassetti.me/wp-content/cache/min/1/wp-content/themes/strumenta/css/responsive.css?ver=1699350009" type="text/css" media="all" />
<link data-minify="1" rel="stylesheet" id="theme-convertkit-css" href="https://tomassetti.me/wp-content/cache/min/1/wp-content/themes/strumenta/css/convertkit.css?ver=1699350009" type="text/css" media="all" />
<style id="generateblocks-inline-css" type="text/css">
.gb-container .wp-block-image img{vertical-align:middle;}.gb-container .gb-shape{position:absolute;overflow:hidden;pointer-events:none;line-height:0;}.gb-container .gb-shape svg{fill:currentColor;}.gb-container-9eef2aab{max-width:1100px;margin-left:auto;margin-right:auto;position:relative;}.gb-container-9eef2aab > .gb-inside-container{padding-bottom:30px;max-width:1100px;margin-left:auto;margin-right:auto;}.gb-grid-wrapper > .gb-grid-column-9eef2aab > .gb-container{display:flex;flex-direction:column;height:100%;}.gb-container-9eef2aab > .gb-shapes .gb-shape-1{color:#f8f8fa;left:0;right:0;bottom:-1px;}.gb-container-9eef2aab > .gb-shapes .gb-shape-1 svg{height:200px;width:calc(100% + 1.3px);position:relative;left:50%;transform:translateX(-50%);min-width:100%;}.gb-container-c48eed81{max-width:1100px;margin-left:auto;margin-right:auto;position:relative;}.gb-container-c48eed81 > .gb-inside-container{padding-bottom:30px;max-width:1100px;margin-left:auto;margin-right:auto;}.gb-grid-wrapper > .gb-grid-column-c48eed81 > .gb-container{display:flex;flex-direction:column;height:100%;}.gb-container-c48eed81 > .gb-shapes .gb-shape-1{color:#f8f8fa;left:0;right:0;bottom:-1px;}.gb-container-c48eed81 > .gb-shapes .gb-shape-1 svg{height:200px;width:calc(100% + 1.3px);position:relative;left:50%;transform:translateX(-50%);min-width:100%;}.gb-container-eb5ec8c7{max-width:1100px;margin-left:auto;margin-right:auto;position:relative;}.gb-container-eb5ec8c7 > .gb-inside-container{padding-bottom:30px;max-width:1100px;margin-left:auto;margin-right:auto;}.gb-grid-wrapper > .gb-grid-column-eb5ec8c7 > .gb-container{display:flex;flex-direction:column;height:100%;}.gb-container-eb5ec8c7 > .gb-shapes .gb-shape-1{color:#f8f8fa;left:0;right:0;bottom:-1px;}.gb-container-eb5ec8c7 > .gb-shapes .gb-shape-1 svg{height:200px;width:calc(100% + 1.3px);position:relative;left:50%;transform:translateX(-50%);min-width:100%;}
</style>
<link rel="stylesheet" id="enlighterjs-css" href="https://tomassetti.me/wp-content/plugins/enlighter/cache/enlighterjs.min.css?ver=17z/oY1XLAuxLN2" type="text/css" media="all" />
<link data-minify="1" rel="stylesheet" id="jetpack_css-css" href="https://tomassetti.me/wp-content/cache/min/1/wp-content/plugins/jetpack/css/jetpack.css?ver=1699350009" type="text/css" media="all" />
<script type="text/javascript" src="https://tomassetti.me/wp-includes/js/jquery/jquery.min.js?ver=3.7.1" id="jquery-core-js"></script>
<script type="text/javascript" src="https://tomassetti.me/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.1" id="jquery-migrate-js"></script>
<link rel="https://api.w.org/" href="https://tomassetti.me/wp-json/" /><link rel="alternate" type="application/json" href="https://tomassetti.me/wp-json/wp/v2/posts/2989" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://tomassetti.me/xmlrpc.php?rsd" />
<meta name="generator" content="WordPress 6.4.3" />
<link rel="shortlink" href="https://wp.me/p4K5DS-Md" />
<link rel="alternate" type="application/json+oembed" href="https://tomassetti.me/wp-json/oembed/1.0/embed?url=https%3A%2F%2Ftomassetti.me%2Fantlr-mega-tutorial%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://tomassetti.me/wp-json/oembed/1.0/embed?url=https%3A%2F%2Ftomassetti.me%2Fantlr-mega-tutorial%2F&#038;format=xml" />
<script type="rocketlazyloadscript" data-rocket-type="text/javascript">
        var opGetCookie = function (name) {
            var value = "; " + document.cookie;
            var parts = value.split("; " + name + "=");
            if (parts.length == 2) return parts.pop().split(";").shift();
        };

        var opDomIsReady = (function(opDomIsReady) {
            var isBrowserIeOrNot = function() {
                return (!document.attachEvent || typeof document.attachEvent === "undefined" ? 'not-ie' : 'ie');
            };

            opDomIsReady = function(callback) {
                if(callback && typeof callback === 'function'){
                    if(isBrowserIeOrNot() !== 'ie') {
                        document.addEventListener("DOMContentLoaded", function() {
                            return callback();
                        });
                    } else {
                        document.attachEvent("onreadystatechange", function() {
                            if(document.readyState === "complete") {
                                return callback();
                            }
                        });
                    }
                } else {
                    console.error('The callback is not a function!');
                }
            };

            return opDomIsReady;
        })(opDomIsReady || {});

        (function(document, window, domIsReady) {
            opDomIsReady(function() {
                function doStuff(){
                    if(window.cid !== undefined){
                        let gaId = opGetCookie('_gid');
                        if(gaId === undefined) return;
                        let gumLinks = document.querySelectorAll('[href*="https://gum.co"]');
                        if (gumLinks.length !== 0) {
                            gumLinks.forEach(function (item) {
                                let href = item.href;
                                if(href.includes('?')){
                                    item.href = href + '&ga_id=' + gaId + '&cid=' + window.cid;
                                }else{
                                    item.href = href + '?ga_id=' + gaId + '&cid=' + window.cid;
                                }

                            })
                        }
                    }else{
                        setTimeout(doStuff,50)
                    }

                }

                doStuff();
            })
        })(document, window, opDomIsReady);




    </script>
<style>img#wpstats{display:none}</style>


<script data-cfasync="false" data-pagespeed-no-defer>
	var dataLayer_content = {"pagePostType":"post","pagePostType2":"single-post","pageCategory":["antlr","language-engineering","parsing"],"pageAttributes":["c","java","javascript","python"],"pagePostAuthor":"Gabriele Tomassetti"};
	dataLayer.push( dataLayer_content );
</script>
<script type="rocketlazyloadscript" data-cfasync="false">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5NMDGS2');
</script>
<link rel="icon" href="https://tomassetti.me/wp-content/uploads/2019/07/cropped-federico-tomassetti-software-architect-icon_large-32x32.png" sizes="32x32" />
<link rel="icon" href="https://tomassetti.me/wp-content/uploads/2019/07/cropped-federico-tomassetti-software-architect-icon_large-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://tomassetti.me/wp-content/uploads/2019/07/cropped-federico-tomassetti-software-architect-icon_large-180x180.png" />
<meta name="msapplication-TileImage" content="https://tomassetti.me/wp-content/uploads/2019/07/cropped-federico-tomassetti-software-architect-icon_large-270x270.png" />
<link rel="shortcut icon" href="https://tomassetti.me/wp-content/themes/strumenta/imgs/ficon.png?v2" type="image/x-icon" />
<meta name="viewport" content="width=device-width">
<script type="rocketlazyloadscript">
		AJAX_URL = 'https://tomassetti.me/wp-admin/admin-ajax.php';
	</script>

<script type="rocketlazyloadscript">
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-11421555-5', 'auto', {'allowLinker': true});
	ga('require', 'linker');
	ga('linker:autoLink', ['tomassetti.me']);

	// anonimizza ip per ottemperare leggi privacy
	ga('set', 'anonymizeIp', true);

	// invia visita come solito
	ga('send', 'pageview');
	</script>
<script type="rocketlazyloadscript" data-rocket-type="text/javascript">
var _iub = _iub || [];
_iub.csConfiguration = {"ccpaAcknowledgeOnDisplay":true,"ccpaApplies":true,"consentOnContinuedBrowsing":false,"enableCcpa":true,"floatingPreferencesButtonDisplay":"bottom-right","invalidateConsentWithoutLog":true,"lang":"en","perPurposeConsent":true,"siteId":1072428,"whitelabel":false,"cookiePolicyId":39769107, "banner":{ "acceptButtonCaptionColor":"#FFFFFF","acceptButtonColor":"#0073CE","acceptButtonDisplay":true,"backgroundColor":"#FFFFFF","closeButtonDisplay":false,"customizeButtonCaptionColor":"#4D4D4D","customizeButtonColor":"#DADADA","customizeButtonDisplay":true,"explicitWithdrawal":true,"listPurposes":true,"position":"float-top-center","rejectButtonCaptionColor":"#FFFFFF","rejectButtonColor":"#0073CE","rejectButtonDisplay":true,"textColor":"#000000" }};
</script>
<script data-minify="1" type="text/javascript" src="https://tomassetti.me/wp-content/cache/min/1/cs/ccpa/stub.js?ver=1699350009"></script>
<script data-minify="1" type="text/javascript" src="https://tomassetti.me/wp-content/cache/min/1/cs/iubenda_cs.js?ver=1699350009" charset="UTF-8" async></script>
</head>
<body class="post-template-default single single-post postid-2989 single-format-standard">
<header>
<div class="flex row full-width vertical-center">
<div class="grid w2 s10">
<div class="site-name">
<a href="https://www.strumenta.com">
<img src="https://tomassetti.me/wp-content/themes/strumenta/imgs/logo.svg" alt="Logo Strumenta" class="logo">
Strumenta </a>
</div>
</div>
<div class="grid w10 s2">
<section class="nav-container">
<a href="#" id="mobile-menu-switcher"><span class="icon icon-menu"></span></a>
<div class="navbar-container" id="navbar-container">
<div class="navbar-padding right">
<div class="menu-strumenta-container"><ul id="main-menu" class><li id="menu-item-6427" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6427"><a href="#">About us</a>
<ul class="sub-menu">
<li id="menu-item-7331" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7331"><a href="https://strumenta.com/how-we-work">How we work</a></li>
<li id="menu-item-7538" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7538"><a href="https://strumenta.com/testimonials/">Testimonials</a></li>
<li id="menu-item-6558" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6558"><a href="https://strumenta.com/working-with-us">Working with us</a></li>
<li id="menu-item-6416" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6416"><a href="https://strumenta.com/our-team/">Our team</a></li>
<li id="menu-item-6428" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6428"><a href="https://strumenta.com/corporate-resources/">Corporate Resources</a></li>
</ul>
</li>
<li id="menu-item-6168" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6168"><a href="https://strumenta.com/services">Services</a>
<ul class="sub-menu">
<li id="menu-item-7537" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7537"><a href="https://strumenta.com/services/rpg-2-python-migration/">Ready-to-go RPG to Python migrartion</a></li>
<li id="menu-item-7408" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7408"><a href="https://strumenta.com/transpilers/">Transpiler</a></li>
<li id="menu-item-7409" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7409"><a href="https://strumenta.com/domain-specific-languages/">Domain Specific Languages</a></li>
<li id="menu-item-7688" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7688"><a href="https://strumenta.com/strategy-consulting/">Strategic Consulting</a></li>
<li id="menu-item-7410" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7410"><a href="https://strumenta.com/consulting-coaching/">Consulting &#038; Coaching</a></li>
<li id="menu-item-7411" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7411"><a href="https://strumenta.com/antlr-consulting/">ANTLR Consulting</a></li>
</ul>
</li>
<li id="menu-item-6169" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6169"><a href="https://strumenta.com/products">Products</a>
<ul class="sub-menu">
<li id="menu-item-7412" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7412"><a href="https://strumenta.com/parsers-ready-to-go/">Parser Ready-to-go</a></li>
<li id="menu-item-7763" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7763"><a href="https://strumenta.com/crafting-powerful-domain-specific-languages/">Crafting Powerful DSLs</a></li>
<li id="menu-item-7689" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7689"><a href="https://strumenta.com/legacy-modernization-course/">Legacy Modernization Course</a></li>
<li id="menu-item-7413" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7413"><a href="https://tomassetti.me/antlr-course-2-edition/?_ga=2.33197502.1287860111.1667471868-1928454070.1613638409">ANTLR Video Course</a></li>
<li id="menu-item-7414" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7414"><a href="https://strumenta.com/antlr-faq/">ANTLR Cheetsheet &#038; FAQ</a></li>
</ul>
</li>
<li id="menu-item-6219" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-6219"><a href="https://tomassetti.me/">Articles</a></li>
<li id="menu-item-6171" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6171"><a href="https://strumenta.com/contact-us/">Contacts</a></li>
</ul></div> </div>
</div>
</section>
<a href="#" id="mobile-menu-switcher-close"><span class="icon icon-cancel"></span></a>
</div>
</div>
</header>
<section id="contents">
<section class="page-header">
<div class="global-message">
The tomassetti.me website has changed: it is now part of strumenta.com. You will continue to find all the news with the usual quality, but in a new layout. </div>
<div class="flex row full-width vertical-bottom">
<div class="grid w6">
<section class="page-title">
<h1>The ANTLR Mega Tutorial</h1>
</section>
</div>
<div class="grid w6">
<section class="page-thumbnail">
<img width="1024" height="512" src="https://tomassetti.me/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial.jpg" class="attachment-large size-large wp-post-image" alt="ANTLR Mega Tutorial" decoding="async" fetchpriority="high" srcset="https://tomassetti.me/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial.jpg 1024w, https://tomassetti.me/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-300x150.jpg 300w, https://tomassetti.me/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-768x384.jpg 768w, https://tomassetti.me/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-705x353.jpg 705w, https://tomassetti.me/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-450x225.jpg 450w" sizes="(max-width: 1024px) 100vw, 1024px" /> </section>
</div>
</section>
<section class="page-meta">
<div class="row full-width">
<div class="grid w6">
<section class="page-info">
Written by <a href="https://strumenta.com/our-team/">Gabriele Tomassetti</a><br>
in <a href="https://tomassetti.me/category/language-engineering/antlr/" rel="category tag">ANTLR</a>, <a href="https://tomassetti.me/category/language-engineering/" rel="category tag">Language Engineering</a>, <a href="https://tomassetti.me/category/language-engineering/parsing/" rel="category tag">Parsing</a><br>
<div class="sharing-social">
<a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ftomassetti.me%2Fantlr-mega-tutorial%2F" target="_blank"><span class="icon icon-facebook"></span> <span class="social-name">Facebook</span></a>
<a class="twitter" href="https://twitter.com/intent/tweet?text=The+ANTLR+Mega+Tutorial&amp;url=https%3A%2F%2Ftomassetti.me%2Fantlr-mega-tutorial%2F" target="_blank"><span class="icon icon-twitter"></span> <span class="social-name">Twitter</span></a>
<a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Ftomassetti.me%2Fantlr-mega-tutorial%2F&amp;title=The+ANTLR+Mega+Tutorial" target="_blank"><span class="icon icon-linkedin"></span> <span class="social-name">LinkedIn</span></a>
</div>
</section>
</div>
</div>
</section>
<section class="page-content">
<div class="row">
<div class="grid w8 center">
<section class="toc">
<ul>
</ul>
</section>
<div class="the-content">
<p>Parsers are powerful tools and using ANTLR you could write all sort of parsers, usable from many different languages.</p>
<p>In this complete tutorial we are going to:</p>
<ul><li><strong>explain the basics</strong>: what a parser is, what it can be used for</li><li>see <strong>how to setup ANTLR</strong> to be used from JavaScript, Python, Java and C#</li><li>discuss <strong>how to test</strong> your parser</li><li>present the most <strong>advanced and useful features</strong> present in ANTLR: you will learn all you need to parse all possible languages</li><li>show <strong>tons of examples</strong></li></ul>
<p>Maybe you have read some tutorial that was too complicated or so incomplete that seemed to assume that you already knew how to use a parser. This is not that kind of tutorial. We just expect you to know how to code and how to use a text editor or an IDE. Thatâ€™s it.</p>
<p>At the end of this tutorial:</p>
<ul><li>you will be able to write a parser to recognize different formats and languages</li><li>you will be able to create all the rules you need to build a lexer and a parser</li><li>you will know how to deal with the common problems you will encounter</li><li>you will understand errors and you will know how to avoid them by testing your grammar.</li></ul>
<p>In other words, we will start from the very beginning and when we reach the end you will have learned all you could possibly need to learn about ANTLR to be productive.</p>
<div class="wp-block-image wp-image-3162 size-large"><figure class="aligncenter"><img decoding="async" width="1030" height="901" src="https://tomassetti.me/wp-content/uploads/2017/02/ANTLR-Mega-Tutorial_Finale_Second-1030x901.png" alt="ANTLR Mega Tutorial Giant List of Content" class="wp-image-3162" srcset="https://tomassetti.me/wp-content/uploads/2017/02/ANTLR-Mega-Tutorial_Finale_Second-1030x901.png 1030w, https://tomassetti.me/wp-content/uploads/2017/02/ANTLR-Mega-Tutorial_Finale_Second-300x263.png 300w, https://tomassetti.me/wp-content/uploads/2017/02/ANTLR-Mega-Tutorial_Finale_Second-768x672.png 768w, https://tomassetti.me/wp-content/uploads/2017/02/ANTLR-Mega-Tutorial_Finale_Second-1500x1313.png 1500w, https://tomassetti.me/wp-content/uploads/2017/02/ANTLR-Mega-Tutorial_Finale_Second-705x617.png 705w, https://tomassetti.me/wp-content/uploads/2017/02/ANTLR-Mega-Tutorial_Finale_Second-450x394.png 450w" sizes="(max-width: 1030px) 100vw, 1030px" /><figcaption>ANTLR Mega Tutorial Giant List of Content</figcaption></figure></div>
<h2 class="wp-block-heading">What is ANTLR?</h2>
<p>ANTLR is a parser generator, a tool that helps you to&nbsp;create parsers. <strong>A parser takes a piece of text and transforms it in an organized structure</strong>, a <em>parse tree</em>, also known as a <em>Abstract Syntax Tree (AST)</em>. You can think of the AST as a story describing the content of the code, or also as its logical representation, created by putting together the various pieces.</p>
<div class="wp-block-image wp-image-2990 size-full"><figure class="aligncenter"><img decoding="async" width="798" height="900" src="https://tomassetti.me/wp-content/uploads/2017/01/798px-Abstract_syntax_tree_for_Euclidean_algorithm.svg_.png" alt="An abstract syntax tree for the Euclidean algorithm" class="wp-image-2990" srcset="https://tomassetti.me/wp-content/uploads/2017/01/798px-Abstract_syntax_tree_for_Euclidean_algorithm.svg_.png 798w, https://tomassetti.me/wp-content/uploads/2017/01/798px-Abstract_syntax_tree_for_Euclidean_algorithm.svg_-266x300.png 266w, https://tomassetti.me/wp-content/uploads/2017/01/798px-Abstract_syntax_tree_for_Euclidean_algorithm.svg_-768x866.png 768w, https://tomassetti.me/wp-content/uploads/2017/01/798px-Abstract_syntax_tree_for_Euclidean_algorithm.svg_-625x705.png 625w, https://tomassetti.me/wp-content/uploads/2017/01/798px-Abstract_syntax_tree_for_Euclidean_algorithm.svg_-450x508.png 450w" sizes="(max-width: 798px) 100vw, 798px" /><figcaption>Graphical representation of an AST for the Euclidean algorithm</figcaption></figure></div>
<p>What you need to do to get a parse tree:</p>
<ol><li>define a lexer and parser grammar</li><li>invoke ANTLR: it will generate a lexer and a parser in your target language (e.g., Java, Python, C#, JavaScript)</li><li>use the generated lexer and parser: you invoke them passing the code to recognize and they return to you a parse tree</li></ol>
<p>So you need to start by defining a lexer and parser grammar&nbsp;for the thing that you are analyzing. Usually the &#8220;thing&#8221; is a language, but it could also be a data format, a diagram, or any kind of structure that is represented with text.</p>
<p>Notice that technically what you get from ANTLR is a <em>parse tree </em>rather than an <em>AST</em>. The difference is that a parse tree is exactly what comes out of the parser, while the AST is a more refined version of the parse tree. You create the AST by manipulating the parse tree, in order to get something that is easier to use by subsequent parts of your program. These changes are sometimes necessary because a parse tree might be organized in a way that make parsing easier or better performing. However, you might prefer something more user friendly in the rest of the program.</p>
<p>The distinction in moot in our examples shown here, given they are quite simple, so we use the terms interchangeably here. However, it is something to keep in mind while reading other documents.</p>
<h2 class="wp-block-heading">Are not Regular Expressions Enough?</h2>
<p>If you are the typical programmer, you may ask yourself <em>why can&#8217;t I use a regular expression</em>? A regular expression is quite useful, such as when you want to find a number in a string of text, but it also has many limitations.</p>
<p>The most obvious is the lack of recursion: you cannot find a (regular) expression inside another one, unless you code it by hand for each level. Something that quickly became <span lang="en-US">unmaintainable</span>. But the larger problem is that it is not really scalable: if you are going to put together even just a few regular expressions, you are going to create a fragile mess that would be hard to maintain.</p>
<blockquote class="wp-block-quote"><p>It is not that easy to use regular expressions</p></blockquote>
<p>Have you ever tried parsing HTML with a regular expression? It is a terrible idea, for one you risk summoning <a href="https://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/">Cthulhu</a>, but more importantly <strong>it does not really work</strong>. You do not believe me?&nbsp;Let&#8217;s see, you want to find the elements of a table, so you try a regular expression like this one: <code>&lt;table&gt;(.*?)&lt;/table&gt;</code>. Brilliant! You did it! Except somebody adds attributes to&nbsp;their table, such as <code>style</code> or <code>id</code>. It does not matter, you do this: <code>&lt;table.*?&gt;(.*?)&lt;/table&gt;</code>. Still, you actually cared about the data inside the table. So you now need to parse <code>tr</code> and <code>td</code>, but they are full of tags.</p>
<p>Therefore you need to eliminate that, too. And somebody dares even to use comments like <code>&lt;!--- my comment &amp;gtl---&gt;</code>. Comments can be used everywhere, and that is not easy to treat with your regular expression. Is it?</p>
<p>So you forbid the internet to use comments in HTML: <em>problem solved</em>.</p>
<p>Or alternatively you use ANTLR, whatever seems simpler to you.</p>
<h2 class="wp-block-heading">ANTLR vs Writing Your Own Parser by Hand</h2>
<p>Okay, you are convinced, you need a parser,&nbsp;but why to use a parser generator like ANTLR instead of building your own?</p>
<blockquote class="wp-block-quote"><p>The main advantage of ANTLR is productivity</p></blockquote>
<p>If you actually have to work with a parser all the time, because your language, or format, is evolving,&nbsp;you need to be able to keep the pace. This is something you cannot do if you have to deal with the details of implementing a parser. Since you are not parsing for parsing&#8217;s sake, you must have the chance to concentrate on accomplishing your goals. And ANTLR makes it much easier to do that, rapidly and cleanly.</p>
<p>As second thing, once you defined your grammars you can ask ANTLR to generate multiple parsers in different languages. For example, you can get a parser in C# and one in JavaScript to parse the same language in a desktop application and in a web application.</p>
<p>Some people argue that writing a parser by hand you can make it faster and you can produce better error messages. There is some truth in this, but in my experience parsers generated by ANTLR are always fast enough. You can tweak them and improve both performance and error handling by working on your grammar, if you really need to. And you can do that once you are happy with your grammar.</p>
<h2 class="wp-block-heading">Table of Content<em>s</em></h2>
<p>Two small notes:</p>
<ul><li>in the <a href="https://github.com/gabriele-tomassetti/antlr-mega-tutorial">companion repository of this tutorial</a> you are going to find all the code with testing, even where we don&#8217;t see it in the article</li><li>the examples will be in different languages, but the knowledge would be generally applicable to any language</li></ul>
<h3 class="wp-block-heading">Setup</h3>
<ol><li><a href="#chapter11">Setup ANTLR</a></li><li><a href="#chapter16">Javascript Setup</a></li><li><a href="#chapter17">Python Setup</a></li><li><a href="#chapter18">Java Setup</a></li><li><a href="#chapter19">C# Setup</a></li></ol>
<h3 class="wp-block-heading">Beginner</h3>
<ol start="6"><li><a href="#chapter23">Lexers and Parsers</a></li><li><a href="#chapter24">Creating a Grammar</a></li><li><a href="#chapter-27">Designing a Data Format</a></li><li><a href="#chapter28">Lexer Rules</a></li><li><a href="#chapter29">Parser Rules</a></li><li><a href="#chapter30">Mistakes and Adjustments</a></li></ol>
<h3 class="wp-block-heading">Mid-Level</h3>
<ol start="12"><li><a href="#chapter34">Setting Up the Chat Project in Javascript</a></li><li><a href="#chapter35">Antlr.js</a></li><li><a href="#chapter36">HtmlChatListener.js</a></li><li><a href="#chapter37">Working with&nbsp;a Listener</a></li><li><a href="#chapter38">Solving Ambiguities with Semantic Predicates</a></li><li><a href="#chapter39">Continuing the Chat in Python</a></li><li><a href="#chapter40">The Python Way of Working with a Listener</a></li><li><a href="#chapter41">Testing with Python</a></li><li><a href="#chapter42">Parsing Markup</a></li><li><a href="#chapter43">Lexical Modes</a></li><li><a href="#chapter44">Parser Grammars</a></li></ol>
<h3 class="wp-block-heading">Advanced</h3>
<ol start="23"><li><a href="#chapter47">The Markup Project in Java</a></li><li><a href="#chapter48">The Main App.java</a></li><li><a href="#chapter49">Transforming Code with ANTLR</a></li><li><a href="#chapter50">Joy and Pain of Transforming Code</a></li><li><a href="#chapter51">Advanced Testing</a></li><li><a href="#chapter52">Dealing with Expressions</a></li><li><a href="#chapter53">Parsing Spreadsheets</a></li><li><a href="#chapter54">The Spreadsheet Project in C#</a></li><li><a href="#chapter55">Excel is Doomed</a></li><li><a href="#chapter56">Testing Everything</a></li></ol>
<h3 class="wp-block-heading">Final Remarks</h3>
<ol start="33"><li><a href="#chapter58">Tips and Tricks</a></li><li><a href="#chapter63">Conclusions</a></li></ol>
<h2 class="wp-block-heading">Setup</h2>
<script data-minify="1" src="https://tomassetti.me/wp-content/cache/min/1/assets/CKJS4.js?ver=1699350011"></script>
<div class="ck_form ck_vertical_subscription_form">
<div class="ck_form_content">
<h3 class="ck_form_title">The ANTLR Mega Tutorial as a PDF</h3>
<div class="ck_description">
<span class="ck_image">
<img decoding="async" src="https://convertkit.s3.amazonaws.com/subscription_forms/images/005/153/157/standard/ANTLR_Mega_Tutorial.png?1518435823">
</span>
<p>Get the Mega Tutorial delivered to your email and read it when you want on the device you want</p>
</div>
</div>
<div class="ck_form_fields">
<div id="ck_success_msg" style="display:none;">
<p>Success! Now check your email to confirm your subscription.</p>
</div>

<form id="ck_subscribe_form" class="ck_subscribe_form" action="https://api.convertkit.com/landing_pages/341333/subscribe" data-remote="true">
<input type="hidden" value="{&quot;form_style&quot;:&quot;full&quot;,&quot;embed_style&quot;:&quot;inline&quot;,&quot;embed_trigger&quot;:&quot;exit_intent&quot;,&quot;scroll_percentage&quot;:&quot;70&quot;,&quot;delay_seconds&quot;:&quot;10&quot;,&quot;display_position&quot;:&quot;br&quot;,&quot;display_devices&quot;:&quot;all&quot;,&quot;days_no_show&quot;:&quot;15&quot;,&quot;converted_behavior&quot;:&quot;hide&quot;}" id="ck_form_options">
<input type="hidden" name="id" value="341333" id="landing_page_id">
<input type="hidden" name="ck_form_recaptcha" value id="ck_form_recaptcha">
<div class="ck_errorArea">
<div id="ck_error_msg" style="display:none">
<p>There was an error submitting your subscription. Please try again.</p>
</div>
</div>
<div class="ck_control_group ck_first_name_field_group">
<label class="ck_label" for="ck_firstNameField">First Name</label>
<input type="text" name="first_name" class="ck_first_name" id="ck_firstNameField">
</div>
<div class="ck_control_group ck_email_field_group">
<label class="ck_label" for="ck_emailField">Email Address</label>
<input type="email" name="email" class="ck_email_address" id="ck_emailField" required>
</div>
<div class="ck_control_group ck_captcha2_h_field_group ck-captcha2-h" style="position: absolute !important;left: -999em !important;">
<label class="ck_label" for="ck_captcha2_h">We use this field to detect spam bots. If you fill this in, you will be marked as a spammer.</label>
<input type="text" name="captcha2_h" class="ck-captcha2-h" id="ck_captcha2_h">
</div>
<label class="ck_checkbox" style>
<input class="optIn ck_course_opted" name="course_opted" type="checkbox" id="optIn" checked>
<span class="ck_opt_in_prompt"><p>I&#8217;d like to learn more about ANTLR and parsing</p></span>
</label>
<button class="subscribe_button ck_subscribe_button btn fields" id="ck_subscribe_button">
Send me the PDF
</button>
<span class="ck_guarantee">
<a class="ck_powered_by" href="https://convertkit.com/features/forms?utm_campaign=poweredby&amp;utm_content=form&amp;utm_medium=referral&amp;utm_source=dynamic">Powered by ConvertKit</a>
</span>
</form>
</div>
</div>
<style type="text/css">/* Layout */
  .ck_form {
  /* divider image */
	background: #fff url(data:image/gif;base64,R0lGODlhAQADAIABAMzMzP///yH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMTQgNzkuMTUxNDgxLCAyMDEzLzAzLzEzLTEyOjA5OjE1ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUQ5NjM5RjgxQUVEMTFFNEJBQTdGNTQwMjc5MTZDOTciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUQ5NjM5RjkxQUVEMTFFNEJBQTdGNTQwMjc5MTZDOTciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxRDk2MzlGNjFBRUQxMUU0QkFBN0Y1NDAyNzkxNkM5NyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxRDk2MzlGNzFBRUQxMUU0QkFBN0Y1NDAyNzkxNkM5NyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACH5BAEAAAEALAAAAAABAAMAAAICRFIAOw==) repeat-y center top;
	font-family: "Helvetica Neue", Helvetica, Arial, Verdana, sans-serif;
	line-height: 1.5em;
	overflow: hidden;
	color: #666;
	font-size: 16px;
	border-top: solid 20px #3071b0;
  border-top-color: #3071b0;
	border-bottom: solid 10px #3d3d3d;
  border-bottom-color: #1d446a;
	-webkit-box-shadow: 0px 0px 5px rgba(0,0,0,.3);
	-moz-box-shadow: 0px 0px 5px rgba(0,0,0,.3);
	box-shadow: 0px 0px 5px rgba(0,0,0,.3);
	clear: both;
	margin: 20px 0px;
}

.ck_form, .ck_form * {
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	box-sizing: border-box;
}

#ck_subscribe_form {
  clear: both;
}

/* Element Queries â€”Â uses JS */

.ck_form_content, .ck_form_fields {
	width: 50%;
	float: left;
	padding: 5%;
}

.ck_form.ck_horizontal {
}

.ck_form_content {
	border-bottom: none;
}

.ck_form.ck_vertical {
	background: #fff;
}

.ck_vertical .ck_form_content, .ck_vertical .ck_form_fields {
	padding: 10%;
	width: 100%;
	float: none;
}

.ck_vertical .ck_form_content {
	border-bottom: 1px dotted #aaa;
	overflow: hidden;
}

/* Trigger the vertical layout with media queries as well */

@media all and (max-width: 499px) {

	.ck_form {
		background: #fff;
	}

	.ck_form_content, .ck_form_fields {
		padding: 10%;
		width: 100%;
		float: none;
	}

	.ck_form_content {
		border-bottom: 1px dotted #aaa;
	}

}

/* Content */

.ck_form_content h3 {
	margin: 0px 0px 15px;
	font-size: 24px;
	padding: 0px;
}


.ck_form_content p {
	font-size: 14px;
}

.ck_image {
	float: left;
	margin-right: 5px;
}

/* Form fields */

.ck_errorArea {
	display: none;
}

#ck_success_msg {
	padding: 10px 10px 0px;
	border: solid 1px #ddd;
	background: #eee;
}

.ck_label {
	font-size: 14px;
	font-weight: bold;
}

.ck_form input[type="text"], .ck_form input[type="email"] {
	font-size: 14px;
	padding: 10px 8px;
	width: 100%;
	border: 1px solid #d6d6d6; /* stroke */
	-moz-border-radius: 4px;
	-webkit-border-radius: 4px;
	border-radius: 4px; /* border radius */
	background-color: #f8f7f7; /* layer fill content */
	margin-bottom: 5px;
	height: auto;
}

.ck_form input[type="text"]:focus, .ck_form input[type="email"]:focus {
	outline: none;
	border-color: #aaa;
}

.ck_checkbox {
  padding: 10px 0px 10px 20px;
  display: block;
  clear: both;
}

.ck_checkbox input.optIn {
  margin-left: -20px;
  margin-top: 0;
}
.ck_form .ck_opt_in_prompt {
  margin-left: 4px;
}
.ck_form .ck_opt_in_prompt p {
  display: inline;
}

.ck_form .ck_subscribe_button {
    width: 100%;
    color: #fff;
    margin: 10px 0px 0px;
    padding:  10px 0px;
    font-size: 18px;
    background: #0d6db8;
    -moz-border-radius: 4px;
    -webkit-border-radius: 4px;
    border-radius: 4px; /* border radius */
    cursor: pointer;
    border: none;
    text-shadow: none;
  }


.ck_form .ck_guarantee {
	color: #626262;
	font-size: 12px;
	text-align: center;
	padding: 5px 0px;
	display: block;
}

.ck_form .ck_powered_by {
	display: block;
	color: #aaa;
}

.ck_form .ck_powered_by:hover {
	display: block;
	color: #444;
}

.ck_converted_content {
  display: none;
	padding: 5%;
	background: #fff;
}



.ck_powered_by { display: none !important; }

</style>
<p>In this section we prepare our development environment to work with ANTLR: the parser generator tool, the supporting tools and the runtimes for each language.</p>
<h2 class="wp-block-heading" id="setup-antlr">1. Setup ANTLR</h2>
<p>ANTLR is actually made up of two main parts: the tool, used to generate the lexer and parser, and the runtime, needed to run them.</p>
<p>The tool will be needed just by you, the language engineer, while the runtime will be included in the final software created by you.</p>
<p>The tool is always the same no matter which language you are targeting: it is a Java program that you need on your development machine. It is used to generate the lexer and parser. While the runtime is different for every language and must be available both to the developer and to the user. It is needed to run the program.</p>
<p>The only requirement for the tool is that you have installed at least <strong>Java 1.7</strong>. To install the Java program, you need to download the latest version from the official site, which at the moment is:</p>
<pre class="EnlighterJSRAW" data-enlighter-language="raw" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>https://www.antlr.org/download/antlr-4.9.3-complete.jar</pre>
<h3 class="wp-block-heading">Instructions</h3>
<ol><li>copy the downloaded tool where you usually put third-party java libraries (ex. <code>/usr/local/lib</code> or <code>C:\Program Files\Java\libs</code>)</li><li>add the tool to your&nbsp;<code>CLASSPATH</code>. Add it to your startup script (ex. <code>.bash_profile</code>)</li><li>(optional) add also aliases to your startup script to simplify the usage of ANTLR</li></ol>
<h4 class="wp-block-heading">Executing the instructions on Linux/Mac OS</h4>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group># 1.
sudo cp antlr-4.9.3-complete.jar /usr/local/lib/
# 2. and 3.
# add this to your .bash_profile
export CLASSPATH=".:/usr/local/lib/antlr-4.9.3-complete.jar:$CLASSPATH"
# simplify the use of the tool to generate lexer and parser
alias antlr4='java -Xmx500M -cp "/usr/local/lib/antlr-4.9.3-complete.jar:$CLASSPATH" org.antlr.v4.Tool'
# simplify the use of the tool to test the generated code
alias grun='java -Xmx500M -cp "/usr/local/lib/antlr-4.9.3-complete.jar:$CLASSPATH" org.antlr.v4.gui.TestRig'</pre>
<h4 class="wp-block-heading">Executing the instructions on Windows</h4>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>// 1. Copy antlr-4.9.3-complete.jar in C:\Program Files\Java\libs (or wherever you prefer)
// 2. Append the location of ANTLR to the CLASSPATH variable on your system, or create a CLASSPATH variable if you have not done so before
// you can do to that by pressing WIN + R and typing sysdm.cpl, then selecting Advanced (tab) > Environment variables > System Variables
// CLASSPATH -> .;C:\Program Files\Java\libs\antlr-4.9.3-complete.jar;%CLASSPATH%
// 3. Add aliases
// create antlr4.bat  
java org.antlr.v4.Tool %* 
// create grun.bat  
java org.antlr.v4.gui.TestRig %*
// put them in the system PATH or any of the directories included in your PATH</pre>
<h3 class="wp-block-heading">Typical Workflow</h3>
<p>When you use ANTLR you start by writing a <em>grammar</em>, a file with extension <code>.g4</code>, which contains the rules of the language that you are analyzing. You then use the <code>antlr4</code> program to generate the files that your program will actually use, such as the lexer and the parser.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>antlr4 &lt;options> &lt;grammar-file-g4></pre>
<p>There are a couple of important options you can specify when running <code>antlr4</code>.</p>
<p>First, you can specify the target language, to generate a parser in Python or JavaScript or any other target different from Java (which is the default one). The other ones are used to generate visitor and listener (do not worry if you do not yet know what these are, we are going to explain them later).</p>
<p>By default only the listener is generated, so to create the visitor you use the&nbsp;<code>-visitor</code> command line option, and <code>-no-listener</code> if you do not want to generate the listener. There are also the opposite&nbsp;options, <code>-no-visitor</code> and <code>-listener</code>, but they represent the default behavior.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>antlr4 -visitor &lt;Grammar-file></pre>
<p>You can optionally test&nbsp;your grammar using a little utility named <code>TestRig</code> (although, as we have seen, it is usually aliased to <code>grun</code>).</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>grun &lt;grammar-name> &lt;rule-to-test> &lt;input-filename(s)></pre>
<p>The filename(s) are optional and you can instead analyze the input that you type on the console.</p>
<p>If you want to use the testing tool, you need to generate a Java parser, even if your program is written in another language. This can be done just by selecting a different option with <code>antlr4</code>.</p>
<p><code>Grun</code> is useful when testing manually the first draft of your grammar. As it becomes more stable, you may want to relay on automated tests (we will see how to write them).</p>
<p><code>Grun</code> also has a few useful options: <code>-tokens</code>, to show the tokens detected,&nbsp; <code>-gui</code> to generate an image of the AST.</p>
<h2 class="wp-block-heading" id="javascript-setup">2. JavaScript Setup</h2>
<p>You can put your grammars in the same folder as&nbsp;your JavaScript files. The file containing the grammar must have the same name of the grammar, which must be declared at the top of the file.</p>
<p>In the following example the name is <code>Chat</code> and the file is <code>Chat.g4</code>.</p>
<p>We can create the corresponding JavaScript parser simply by specifying the correct option with the ANTLR4 Java program.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>antlr4 -Dlanguage=JavaScript Chat.g4</pre>
<p>Notice that the option is case-sensitive, so&nbsp;pay attention to the uppercase &#8216;S&#8217;.&nbsp;If you make a mistake you will receive a message like the following.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>error(31):  ANTLR cannot generate Javascript code as of version 4.9</pre>
<p>ANTLR can be used both with <code>node.js</code> and in the browser. For the browser you need to use <code>webpack</code> or <code>require.js</code>. If you do not know how to use either of the two, you can look at the <a href="https://github.com/antlr/antlr4/blob/master/doc/javascript-target.md">official documentation for some help</a>&nbsp;or read this tutorial on <a href="https://tomassetti.me/antlr-and-the-web/">antlr in the web</a>.</p>
<p>In this tutorial we are going to use <code>node.js</code>, for which you can install the ANTLR runtime simply by using the following standard command.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>npm install antlr4</pre>
<h2 class="wp-block-heading" id="python-setup">3. Python Setup</h2>
<p>When you have a grammar, you put that in the same folder as your Python files. The file must have the same name of the grammar, which must be declared at the top of the file. In the following example the name is <code>Chat</code> and the file is <code>Chat.g4</code>.</p>
<p>We can create the corresponding Python parser simply by specifying the correct option with the ANTLR4 Java program. For Python, you also need to pay attention to the version of Python, which can be either 2 or 3.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>antlr4 -Dlanguage=Python3 Chat.g4</pre>
<p>The runtime is available from PyPi so you just can install it using pip.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>pip install antlr4-python3-runtime</pre>
<p>Again, you just have to remember to specify&nbsp;the proper python version.</p>
<h2 class="wp-block-heading" id="java-setup">4. Java Setup</h2>
<p>To setup a Java project using ANTLR you can do things manually, using the command line that comes with your OS. Or you can be a civilized person and use Gradle or Maven. We are using Gradle here, but you can look at a typical setup using <a href="https://github.com/antlr/antlr4/blob/master/doc/java-target.md">Maven in the ANTLR documentation</a>. Both build systems have a large community, so it depends on your preference or needs which one to choose. </p>
<p>Also, you can look into ANTLR plugins for your favorite IDE.</p>
<p>This is how we typically setup a Gradle project. We use a Gradle plugin to invoke ANTLR. Since we use IntellJ IDEA, we also use the Gradle IDEA plugin to generate the correct configuration for that IDE.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="groovy" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>plugins {
    id 'java'
    id 'antlr'
    id 'idea'
}

repositories {
    mavenCentral()
    jcenter()
}

dependencies {
    antlr "org.antlr:antlr4:4.9.3"
    compile "org.antlr:antlr4-runtime:4.9.3"
    testImplementation(platform('org.junit:junit-bom:5.7.0'))
    testImplementation('org.junit.jupiter:junit-jupiter')
}

generateGrammarSource {
    maxHeapSize = "128m"
    arguments += ['-package', 'me.tomassetti.examples.MarkupParser', '-visitor', '-no-listener']
}
compileJava.dependsOn generateGrammarSource

sourceSets {
    generated {
        java.srcDir 'generated-src/antlr/main/'
    }
}
compileJava.source sourceSets.generated.java, sourceSets.main.java

clean{
    delete "generated-src"
}

idea {
    module {
        sourceDirs += file("generated-src/antlr/main/")
    }
}

test {
    useJUnitPlatform()
    testLogging {
        events "passed", "skipped", "failed"
    }
}</pre>
<p>We put our grammars directly under <code>src/main/antlr/</code><em>. </em>Thanks to our configuration, Gradle makes sure that the lexer and parser are generated in the directory corresponding to their package. For example, if we want the parser to be in the package <em>me.tomassetti.mylanguage</em> it will be generated into <em>generated-src/antlr/main/me/tomassetti/mylanguage</em>.</p>
<p>At this point we can simply run:</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group># Linux/Mac
./gradlew generateGrammarSource

# Windows
gradlew generateGrammarSource</pre>
<p>And we get the lexer and parser generated from the grammar(s).</p>
<p>Then we can also run:</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group># Linux/Mac
./gradlew idea

# Windows
gradlew idea</pre>
<p>And we have an IDEA Project ready to be opened.</p>
<p>There is a clear advantage in using Java for developing ANTLR grammars: there are plugins for several IDEs and it is the language that the main developer of the tool actually works on. So they are tools, like the <code>org.antlr.v4.gui.TestRig</code>, that can be easily integrated in your workflow and are quite useful, if you want to easily visualize the parse tree of an input.</p>
<h2 class="wp-block-heading" id="csharp-setup">5. C# Setup</h2>
<p>There is support for .NET Framework, Mono and .NET core. We are going to use Visual Studio Code to create our ANTLR project, because there is an excellent extension for it that automate the generation of the parser. It can also can generate lots of graph to help you debug your parser or to create documentation for the users of your parser. It is called <a href="https://marketplace.visualstudio.com/items?itemName=mike-lischke.vscode-antlr4">ANTLR4 grammar syntax support</a> and is created by one of the main contributors to ANTLR.</p>
<h3 class="wp-block-heading">Alternatives If You Are Not Using Visual Studio Code</h3>
<p>There is also a nice extension for Visual Studio 2015 and 2017 created by the same author of the C# target, called <a href="https://marketplace.visualstudio.com/items?itemName=SamHarwell.ANTLRLanguageSupport"><em>ANTLR Language Support</em></a>. You can install it&nbsp;by going in Tools -&gt; Extensions and Updates. This extension will automatically generate parser, lexer and visitor/listener when you build your project. Furthermore, the extension will allow you to create a new grammar file, using the well known menu to add a new item. Last, but not least, you can setup the options to generate listener/visitor right in the properties of each grammar file. This extension is now a bit outdated, but it is still useful if you want to use Visual Studio.</p>
<p>You can also use the usual Java tool to generate everything, even a parser for C#. You can do that just by indicating the right language. In this example the grammar is called <code>Spreadsheet</code>.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>antlr4 -Dlanguage=CSharp Spreadsheet.g4</pre>
<p>Notice that the &#8216;S&#8217; in CSharp is uppercase.</p>
<h3 class="wp-block-heading">Picking the Right Runtime</h3>
<p>There are a few things to remember if you are using the Visual Studio extension. Whether you are using an extension or the standard Java tool you also need an ANTLR4 runtime for your project, and you can install it with the good ol&#8217; <strong>nuget</strong>. But you have to remember that not all runtimes are created equal.</p>
<p>The issue is that in the past there was only a separate C#-optimized package of ANTLR published on nuget. Now instead the main authors of ANTLR published an official package on nuget. However, the author of old C#-optimized version keeps publishing its own package, that is incompatible with the standard ANTLR4 tool. This is not strictly a fork, since the same person continues to be a core contributor to the main ANTLR4 tool, but it is more of a parallel development. The creator of the C#-optimized package is also the author of the Visual Studio extension, Sam Harwell (with the nickname <code>sharwell</code>).</p>
<p>So, only if you are using the Visual Studio Extension you need to use the <a href="https://www.nuget.org/packages/Antlr4.Runtime/">nuget package ANTLR4.runtime, authored by sharwell</a>. If you are using the ANTLR4 tool, or the Visual Studio Code extension, to generate your C# lexer and parser then you need to use the <a href="https://www.nuget.org/packages/Antlr4.Runtime.Standard/">ANTLR4.Runtime.Standard</a>.</p>
<p>Notice that the C#-optimized release is a bit behind the official release. For that reason, if you are just starting now, I would suggest using the official standard runtime.&nbsp; Therefore it would be better to also either use Visual Studio Code as your IDE or not using the Visual Studio extension. This gets you the most updated version of ANTLR. </p>
<p>You also have to remember that both extensions comes with their own internal ANTLR tool, for ease of use. This way you do not need to have ANTLR installed in your system. However, this means that the ANTLR version included might be outdated. You can check the version mentioned in the generated parser file. This may lead to the issue that the parser is generated with an older version of the ANTLR, while the runtime you get with Nuget uses a new version of ANTLR.</p>
<h2 class="wp-block-heading">Beginner</h2>
<p>In this section we lay the foundation you need to use ANTLR: what lexer and parsers are, the syntax to define them in a grammar and the strategies you can use to create one. We also see the first examples to show how to use what you have learned.&nbsp; You can come back to this section if you do not remember how ANTLR works.</p>
<h2 class="wp-block-heading" id="lexers-and-parser">6. Lexers and Parsers</h2>
<p>Before looking into&nbsp;parsers, we need to first look into lexers, also known as tokenizers. They are basically the first stepping stone toward a parser, and of course ANTLR allows you to build them too. <strong>A lexer takes the individual characters and transforms them in tokens</strong>, the atoms that the parser uses to create the logical structure.</p>
<p>Imagine this process applied to a natural language such as English. You are reading the single characters, putting them together until they make a word, and then you combine the different words to form a sentence.</p>
<p>Let&#8217;s look at the following example and imagine that we are trying to parse a mathematical operation.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>437 + 734</pre>
<div class="wp-block-image"><figure class="aligncenter"><img loading="lazy" decoding="async" width="1030" height="187" src="https://tomassetti.me/wp-content/uploads/2017/02/lexer-parser-center-1030x187.png" alt="From the input to the abstract syntax tree" class="wp-image-3107" srcset="https://tomassetti.me/wp-content/uploads/2017/02/lexer-parser-center-1030x187.png 1030w, https://tomassetti.me/wp-content/uploads/2017/02/lexer-parser-center-300x55.png 300w, https://tomassetti.me/wp-content/uploads/2017/02/lexer-parser-center-768x140.png 768w, https://tomassetti.me/wp-content/uploads/2017/02/lexer-parser-center-705x128.png 705w, https://tomassetti.me/wp-content/uploads/2017/02/lexer-parser-center-450x82.png 450w, https://tomassetti.me/wp-content/uploads/2017/02/lexer-parser-center.png 1100w" sizes="(max-width: 1030px) 100vw, 1030px" /></figure></div>
<p>The lexer scans the text and find &#8216;4&#8217;, &#8216;3&#8217;, &#8216;7&#8217; and then the space &#8216; &#8216;. So it knows that the first characters actually represent a number. Then it finds&nbsp;a &#8216;+&#8217; symbol, so it knows that it represents an operator, and lastly it finds&nbsp;another number.</p>
<p>How does it know that? Because we tell it to.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>/*
 * Parser Rules
 */

operation  : NUMBER '+' NUMBER ;

/*
 * Lexer Rules
 */

NUMBER     : [0-9]+ ;

WHITESPACE : ' ' -> skip ;</pre>
<p>This is not a complete grammar, but we can already see that lexer rules are all uppercase, while parser rules are all lowercase. Technically the rule about case applies only to the first character of their names, but usually they are all uppercase or lowercase for clarity.</p>
<p>Rules are typically written in this order: first the&nbsp;parser rules and then the lexer ones, although logically they are applied in the opposite order. It&#8217;s also important to remember that <strong>lexer rules are analyzed in the order that they appear</strong>, and they can be ambiguous.</p>
<p>The typical example is the identifier: in many programming languages it can be any string of letters, but certain combinations, such as &#8220;class&#8221; or &#8220;function&#8221; are forbidden because they indicate a <em>class</em> or a <em>function</em>. So the order of the rules solves the ambiguity by using the first match and that&#8217;s why the tokens identifying keywords such&nbsp;as <em>class</em> or <em>function</em> are defined first, while the one for the identifier is put last.</p>
<blockquote class="wp-block-quote"><p>The basic syntax of a rule is easy: <strong>there is a name, a colon, the definition of the rule and a terminating semicolon</strong></p></blockquote>
<p>The definition of <strong>NUMBER</strong> contains a typical range of digits and a &#8216;+&#8217; symbol to indicate that one or more matches are allowed. These are all very typical indications which I assume you are familiar with; if not, you can read more about the syntax of <a href="https://en.wikipedia.org/wiki/Regular_expression#Syntax">regular expressions</a>.</p>
<p>The most interesting part is at the end, the lexer rule that defines the <strong>WHITESPACE</strong> token. It&#8217;s interesting because it shows how to indicate to ANTLR to ignore something. Consider how ignoring whitespace simplifies parser rules: if we couldn&#8217;t say to ignore WHITESPACE we would have to include it between every single sub-rule of the parser, to let the user puts spaces where they want. Like this:</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>operation  : WHITESPACE* NUMBER WHITESPACE* '+' WHITESPACE* NUMBER;</pre>
<p>And the same typically applies to comments: they can appear everywhere and we do not want to handle them specifically in every single piece of our grammar so we just ignore them (at least while parsing) .</p>
<h2 class="wp-block-heading" id="creating-a-grammar">7. Creating a Grammar</h2>
<p>Now that we have seen the basic syntax of a rule, we can take a look at the two different approaches to define a grammar: top-down and bottom-up.</p>
<h3 class="wp-block-heading">Top-down approach</h3>
<p>This approach consists in starting from the general organization of a file written in your language.</p>
<p>What are the main section of a file? What is their order? What is contained in each section?</p>
<p>For example a Java file can be divided in three sections:</p>
<ul><li>package declaration</li><li>imports</li><li>type definitions</li></ul>
<p>This approach works best when you already know the language or format that you are designing a grammar for. It is probably the strategy preferred by people with a good theoretical background or people who prefer to start with &#8220;the big plan&#8221;.</p>
<p>When using this approach, you start by defining the rule representing the whole file. It will probably include other rules, to represent the main sections. You then define those rules and you move from the most general, abstract rules to the low-level, practical ones.</p>
<h3 class="wp-block-heading">Bottom-up approach</h3>
<p>The bottom-up approach consists in focusing on the small elements first: defining how the tokens are captured, how the basic expressions are defined and so on. Then we move to higher level constructs until we define the rule representing the whole file.</p>
<p>I personally prefer to start from the bottom, the basic items, that are analyzed with the lexer. And then you grow naturally from there to the structure, that is dealt with the parser. This approach permits to focus on a small piece of the grammar, build tests for that, ensure it works as expected and then move on to the next bit.</p>
<p>This approach mimics the way we learn. Furthermore, there is the advantage of starting with real code that is actually quite common among many languages. In fact, most languages have things like identifiers, comments, whitespace, etc. Obviously, you might have to tweak something, for example a comment in HTML is functionally the same as a comment in C#, but it has different delimiters.</p>
<p>The disadvantage of a bottom-up approach rests on the fact that the parser is the thing you actually care about. You werenâ€™t asked to build a lexer, you were asked to build a parser, that could provide a specific functionality. So by starting on the last part, the lexer, you might end up doing some refactoring, if you do not already know how the rest of the program will work.</p>
<h2 class="wp-block-heading">8. Designing a Data Format</h2>
<p>Designing a grammar for a new language is difficult. You have to create a language simple and intuitive for the user, but also unambiguous to make the grammar manageable. It must be concise, clear, natural and it should not get in the way of the user.</p>
<p>So we are starting with something limited: a grammar for a simple chat program.</p>
<p>Let&#8217;s&nbsp;start with a better description of our objective:</p>
<ul><li>there are not going to be paragraphs, and thus we can use newlines as separators between the messages</li><li>we want to allow emoticons, mentions and links. We are not going to support HTML tags</li><li>since our chat is going to be for annoying teenagers, we want to allow users an easy way to SHOUT and to format the color of the text.</li></ul>
<p>Finally teenagers could shout, and all in pink. What a time to be alive.</p>
<h2 class="wp-block-heading" id="lexer-rules">9. Lexer Rules</h2>
<p>We start with defining lexer rules for our chat language. Remember that lexer rules actually are at the end of the files.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>/*
 * Lexer Rules
 */

fragment A          : ('A'|'a') ;
fragment S          : ('S'|'s') ;
fragment Y          : ('Y'|'y') ;
fragment H          : ('H'|'h') ;
fragment O          : ('O'|'o') ;
fragment U          : ('U'|'u') ;
fragment T          : ('T'|'t') ;

fragment LOWERCASE  : [a-z] ;
fragment UPPERCASE  : [A-Z] ;

SAYS                : S A Y S ;

SHOUTS              : S H O U T S;

WORD                : (LOWERCASE | UPPERCASE | '_')+ ;

WHITESPACE          : (' ' | '\t') ;

NEWLINE             : ('\r'? '\n' | '\r')+ ;

TEXT                : ~[\])]+ ;</pre>
<p>In this example we use rules <strong>fragments</strong>: they are reusable building blocks for lexer rules. You define them and then you refer to them in lexer rules. If you define them but do not include them in lexer rules, they simply have no effect.</p>
<p>We define a fragment for the letters we want to use in keywords. Why is that? Because we want to support case-insensitive keywords. Other than to avoid repetition of the case of characters, they are also used when dealing with floating numbers. To avoid repeating digits, before and after the dot/comma. Such as in the following example.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>fragment DIGIT : [0-9] ;
NUMBER         : DIGIT+ ([.,] DIGIT+)? ;</pre>
<p>The <strong>TEXT</strong> token shows how to capture everything,&nbsp;except for the characters that follow the tilde (&#8216;~&#8217;). We are excluding the closing square bracket &#8216;]&#8217;, but since it is a character used to identify the end of a group of characters, we have to escape it by prefixing it with a backslash &#8216;\&#8217;.</p>
<p>The newlines rule is formulated that way because there are actually different ways in which operating systems indicate a newline, some include a <code>carriage return ('\r')</code> others a <code>newline ('\n')</code> character, or a combination of the two.</p>
<h2 class="wp-block-heading" id="parser-rules">10. Parser Rules</h2>
<p>We continue with parser rules, which are the rules with which our program will interact most directly.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>/*
 * Parser Rules
 */

chat                : line+ EOF ;

line                : name command message NEWLINE;

message             : (emoticon | link | color | mention | WORD | WHITESPACE)+ ;

name                : WORD WHITESPACE;

command             : (SAYS | SHOUTS) ':' WHITESPACE ;
                                        
emoticon            : ':' '-'? ')'
                    | ':' '-'? '('
                    ;

link                : '[' TEXT ']' '(' TEXT ')' ;

color               : '/' WORD '/' message '/';

mention             : '@' WORD ;</pre>
<p>The first interesting part is <strong>message</strong>, not so much for what it contains, but the structure it represents. We are saying that a <code>message</code> could be anything of the listed rules in any order. This is a simple way to solve the problem of dealing with whitespace without repeating it every time. Since we, as&nbsp;users,&nbsp;find whitespace irrelevant we see something like <code>WORD WORD mention</code>, but the parser actually sees <code>WORD WHITESPACE WORD WHITESPACE mention WHITESPACE</code>.</p>
<p>Another way of dealing with whitespace, when you can&#8217;t get rid of it, is more advanced: lexical modes. Basically, it allows you to specify two lexer parts: one for the structured part, the other for simple text. This is useful for parsing things like XML or HTML. We are going to show it later.</p>
<p>The <strong>command</strong> rule is obvious, you just have to notice that you cannot have a space between the two options for command and the colon, but you need one <strong>WHITESPACE </strong>after. The <strong>emoticon </strong>rule shows another notation to indicate multiple choices, you can use the pipe character &#8216;|&#8217; without the parenthesis. We support only two emoticons, happy and sad, with or without the middle line.</p>
<p>Something that could be considered a bug, or a poor implementation, is the <strong>link</strong> rule, as we already said, in fact, <strong>TEXT</strong> capture everything apart from certain special characters. You may want to only allows <strong>WORD</strong> and <strong>WHITESPACE,</strong> inside the parentheses, or to force a correct format for a link, inside the square brackets. On the other hand, this allows the user to make a mistake in writing the link without making the parser complain.</p>
<blockquote class="wp-block-quote"><p>You have to remember that the parser cannot check for semantics</p></blockquote>
<p>For instance, it cannot know if the <strong>WORD</strong> indicating the color actually represents a valid color. That is to say, it doesn&#8217;t know that it&#8217;s wrong to use &#8220;dog&#8221; and right to use &#8220;red&#8221;. This must be checked by the logic of the program, that can access which colors are available. You have to find the right balance of dividing enforcement between the grammar and your own code.</p>
<p>The parser should only check the syntax. So the rule of thumb is that when in doubt you let the parser pass the content up to your program. Then, in your program, you check the semantics and make sure that the rule actually have a proper meaning.</p>
<p>Let&#8217;s look at the rule <strong>color:</strong> it can include a <strong>message</strong>,&nbsp; and it itself can be part of <strong>message;</strong> this ambiguity will be solved by the context in which the rule is applied.</p>
<h2 class="wp-block-heading" id="mistakes-and-adjustements">11. Mistakes and Adjustments</h2>
<p>Before trying our new grammar, we have to add a name for it at the beginning of the file. The name must be identical to the file name, which should have the <code>.g4</code> extension.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>grammar Chat;</pre>
<p>You can find how to install everything for your platform in the <a href="http://www.antlr.org/index.html">official documentation</a>. After everything is installed, we create the grammar, compile the generated Java code and then we run the testing tool.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>// lines preceded by $ are commands
// > are input to the tool
// - are output from the tool
$ antlr4 Chat.g4
$ javac Chat*.java
// grun is the testing tool, Chat is the name of the grammar, chat the rule that we want to parse
$ grun Chat chat
> john SAYS: hello @michael this will not work
// CTRL+D on Linux, CTRL+Z on Windows
> CTRL+D/CTRL+Z
- line 1:0 mismatched input 'john SAYS: hello @michael this will not work' expecting WORD</pre>
<p>Okay, it does not work. Why is it expecting <strong>WORD</strong>? It is right there! Let&#8217;s try to find out, using the option <code>-tokens</code> to make it show the tokens it recognizes.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>$ grun Chat chat -tokens
> john SAYS: hello @michael this will not work
- [@0,0:44='john SAYS: hello @michael this will not work',&lt;TEXT>,1:0]
- [@1,45:44='&lt;EOF>',&lt;EOF>,2:0]</pre>
<p>So it only sees the <strong>TEXT</strong> token. But if we put it at the end of the grammar, what will happen? The problem is that it always tries to match the largest possible token. And all this text is a valid <strong>TEXT</strong> token. How do we solve this problem? There are many ways, the first, of course, is just getting rid&nbsp;of that token. But for now we are going to see the second easiest.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>[..]

link                : TEXT TEXT ;

[..]

TEXT                : ('['|'(') ~[\])]+ (']'|')');</pre>
<p>We have changed the problematic token to make it include a preceding parenthesis or square bracket. Note that this is not exactly the same thing, because it would allow two series of parentheses or square brackets. But it is a first step and we are learning here, after all.</p>
<p>Let&#8217;s check if it works:</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>$ grun Chat chat -tokens
> john SAYS: hello @michael this will not work
- [@0,0:3='john',&lt;WORD>,1:0]
- [@1,4:4=' ',&lt;WHITESPACE>,1:4]
- [@2,5:8='SAYS',&lt;SAYS>,1:5]
- [@3,9:9=':',&lt;':'>,1:9]
- [@4,10:10=' ',&lt;WHITESPACE>,1:10]
- [@5,11:15='hello',&lt;WORD>,1:11]
- [@6,16:16=' ',&lt;WHITESPACE>,1:16]
- [@7,17:17='@',&lt;'@'>,1:17]
- [@8,18:24='michael',&lt;WORD>,1:18]
- [@9,25:25=' ',&lt;WHITESPACE>,1:25]
- [@10,26:29='this',&lt;WORD>,1:26]
- [@11,30:30=' ',&lt;WHITESPACE>,1:30]
- [@12,31:34='will',&lt;WORD>,1:31]
- [@13,35:35=' ',&lt;WHITESPACE>,1:35]
- [@14,36:38='not',&lt;WORD>,1:36]
- [@15,39:39=' ',&lt;WHITESPACE>,1:39]
- [@16,40:43='work',&lt;WORD>,1:40]
- [@17,44:44='\n',&lt;NEWLINE>,1:44]
- [@18,45:44='&lt;EOF>',&lt;EOF>,2:0]</pre>
<p>Using the option <code>-gui</code> we can also have a nice, and easier to understand, graphical representation.</p>
<div class="wp-block-image"><figure class="aligncenter"><img loading="lazy" decoding="async" width="641" height="235" src="https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree.png" alt="ANTLR Example Parse Tree" class="wp-image-2993" srcset="https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree.png 641w, https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree-300x110.png 300w, https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree-450x165.png 450w" sizes="(max-width: 641px) 100vw, 641px" /></figure></div>
<p>The dot in mid air represents whitespace.</p>
<p>This works, but it is not very smart or nice, or organized. But don&#8217;t worry, we are going to see a better way later. One positive aspect of this solution is that it allows to show another trick.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>TEXT                : ('['|'(') .*? (']'|')');</pre>
<p>This is an equivalent formulation of the token <strong>TEXT</strong>: the <code>.</code> matches any character, <code>*</code> says that the preceding match can be repeated any time, <code>?</code> indicates that the previous match is non-greedy. That is to say the previous sub-rule matches everything except what follows it, allowing to match the closing parenthesis or square bracket.</p>
<h2 class="wp-block-heading">Mid-Level</h2>
<div class="gb-container gb-container-9eef2aab"><div class="gb-inside-container">
<div class="wp-block-columns is-layout-flex wp-container-core-columns-layout-2 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<div class="wp-block-columns is-layout-flex wp-container-core-columns-layout-1 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow" style="flex-basis:33.33%">
<figure class="wp-block-image size-full is-resized"><img loading="lazy" decoding="async" src="https://tomassetti.me/wp-content/uploads/2018/08/Logo_Standard_nowriting_trasparente.png" alt="Strumenta Logo" class="wp-image-4835" width="120" height="206" srcset="https://tomassetti.me/wp-content/uploads/2018/08/Logo_Standard_nowriting_trasparente.png 476w, https://tomassetti.me/wp-content/uploads/2018/08/Logo_Standard_nowriting_trasparente-174x300.png 174w, https://tomassetti.me/wp-content/uploads/2018/08/Logo_Standard_nowriting_trasparente-409x705.png 409w, https://tomassetti.me/wp-content/uploads/2018/08/Logo_Standard_nowriting_trasparente-450x776.png 450w" sizes="(max-width: 120px) 100vw, 120px" /></figure>
</div>
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow" style="flex-basis:66.66%">
<p style="font-size:30px"><em>Does it looks like too much work?</em><br><strong>â€¦Here there are our ANTLR Services</strong></p>
<p>We can design parsers for new languages, or rewrite parsers for existing languages built in house.</p>
<p>And much moreâ€¦</p>
</div>
</div>
<div class="wp-block-buttons is-content-justification-center is-layout-flex wp-container-core-buttons-layout-1 wp-block-buttons-is-layout-flex">
<div class="wp-block-button is-style-fill"><a class="wp-block-button__link" href="https://strumenta.com/antlr-consulting/" rel>ANTLR Services</a></div>
</div>
</div>
</div>
</div><div class="gb-shapes"><div class="gb-shape gb-shape-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 211.2" preserveAspectRatio="none"><path d="M600 188.4C321.1 188.4 84.3 109.5 0 0v211.2h1200V0c-84.3 109.5-321.1 188.4-600 188.4z" /></svg></div></div></div>
<p>In this section we see how to use ANTLR in your programs, the libraries and functions you need to use, how to test your parsers, and the like. We see what is and how to use a listener. We also build up on our knowledge of the basics, by looking at more advanced concepts, such as semantic predicates. While our projects are mainly in JavaScript and Python, the concept are generally applicable to every language. You can come back to this section when you need to remember how to get your project organized.</p>
<h2 class="wp-block-heading" id="setup-antlr-with-javascript">12. Setting Up the Chat Project with JavaScript</h2>
<p>In the previous sections we have seen how to build a grammar for a chat program , piece by piece. Let&#8217;s now copy that grammar we just created in the same folder of our Javascript files.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>grammar Chat;

/*
 * Parser Rules
 */

chat                : line+ EOF ;

line                : name command message NEWLINE ;

message             : (emoticon | link | color | mention | WORD | WHITESPACE)+ ;

name                : WORD WHITESPACE;

command             : (SAYS | SHOUTS) ':' WHITESPACE ;
                                        
emoticon            : ':' '-'? ')'
                    | ':' '-'? '('
                    ;

link                : TEXT TEXT ;

color               : '/' WORD '/' message '/';

mention             : '@' WORD ;


/*
 * Lexer Rules
 */

fragment A          : ('A'|'a') ;
fragment S          : ('S'|'s') ;
fragment Y          : ('Y'|'y') ;
fragment H          : ('H'|'h') ;
fragment O          : ('O'|'o') ;
fragment U          : ('U'|'u') ;
fragment T          : ('T'|'t') ;

fragment LOWERCASE  : [a-z] ;
fragment UPPERCASE  : [A-Z] ;

SAYS                : S A Y S ;

SHOUTS              : S H O U T S ;

WORD                : (LOWERCASE | UPPERCASE | '_')+ ;

WHITESPACE          : (' ' | '\t')+ ;

NEWLINE             : ('\r'? '\n' | '\r')+ ;

TEXT                : ('['|'(') ~[\])]+ (']'|')');
</pre>
<p>We can create the corresponding Javascript parser simply by specifying the correct option with the ANTLR4 Java program.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>antlr4 -Dlanguage=JavaScript Chat.g4</pre>
<p>Now you will find some new files in the folder, with names such as <code>ChatLexer.js,</code> <code>ChatParser.js</code> and there are also *.tokens files, none of which contains anything interesting for us, unless you want to understand the inner workings of ANTLR.</p>
<p>The file you want to look at is <code>ChatListener.js</code>,&nbsp; you are not going to modify anything in it, but it contains methods and functions that we will override with our own listener. We are not going to modify it because changes would be overwritten every time the grammar is regenerated.</p>
<p>Looking into it, you can see several enter/exit functions, a pair for each of our parser rules. These functions will be invoked when a piece of code matching the rule is encountered. This is the default implementation of the listener that allows you to just override the functions that you need, on your derived listener, and leave the rest as is.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="js" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>import antlr4 from 'antlr4';

// This class defines a complete listener for a parse tree produced by ChatParser.
export default class ChatListener extends antlr4.tree.ParseTreeListener {

	// Enter a parse tree produced by ChatParser#chat.
	enterChat(ctx) {
	}

	// Exit a parse tree produced by ChatParser#chat.
	exitChat(ctx) {
	}

[..]</pre>
<p>The alternative to creating a <code>Listener</code> is creating a <code>Visitor</code>. The main differences are that you can neither control the flow of a listener nor return anything from its functions, while you can do both of them with a visitor. So if you need to control how the nodes of the parse tree are entered, or to gather information from several of them, you probably want to use a visitor. This is useful, for example, with code generation, where some information that is needed to create new source code is spread around many parts. Both the listener and the visitor&nbsp;use depth-first search.</p>
<p>A depth-first search means that when a node is accessed, its children will be accessed, and if one of the children nodes has its own children, they will be accessed before continuing on with the other children of the first node. The following image will make the concept simpler to understand.</p>
<div class="wp-block-image"><figure class="aligncenter"><img loading="lazy" decoding="async" width="641" height="235" src="https://tomassetti.me/wp-content/uploads/2017/03/antlr4_parse_tree_depth.png" alt="Depth-first search" class="wp-image-3165" srcset="https://tomassetti.me/wp-content/uploads/2017/03/antlr4_parse_tree_depth.png 641w, https://tomassetti.me/wp-content/uploads/2017/03/antlr4_parse_tree_depth-300x110.png 300w, https://tomassetti.me/wp-content/uploads/2017/03/antlr4_parse_tree_depth-450x165.png 450w" sizes="(max-width: 641px) 100vw, 641px" /></figure></div>
<p>So in the case of a listener, an enter event will be fired at the first encounter with the node and an exit one will be fired after having exited all of its children. In the following image you can see the example of what functions will be fired when a listener would met a <strong>line</strong> node (for simplicity only the functions related to <strong>line</strong> are shown).</p>
<div class="wp-block-image"><figure class="aligncenter"><img loading="lazy" decoding="async" width="641" height="235" src="https://tomassetti.me/wp-content/uploads/2017/03/antlr4_parse_tree_listener.png" alt="ANTLR Listener Example" class="wp-image-3166" srcset="https://tomassetti.me/wp-content/uploads/2017/03/antlr4_parse_tree_listener.png 641w, https://tomassetti.me/wp-content/uploads/2017/03/antlr4_parse_tree_listener-300x110.png 300w, https://tomassetti.me/wp-content/uploads/2017/03/antlr4_parse_tree_listener-450x165.png 450w" sizes="(max-width: 641px) 100vw, 641px" /></figure></div>
<p>With a standard visitor, the behavior will be analogous except, of course, that only a single visit event will be fired for every single node. In the following image you can see the example of what function will be fired when a visitor meets a <strong>line</strong> node (for simplicity only the function related to <strong>line</strong> is shown).</p>
<div class="wp-block-image"><figure class="aligncenter"><img loading="lazy" decoding="async" width="641" height="235" src="https://tomassetti.me/wp-content/uploads/2017/03/antlr4_parse_tree_visitor.png" alt="ANTLR Visitor Example" class="wp-image-3167" srcset="https://tomassetti.me/wp-content/uploads/2017/03/antlr4_parse_tree_visitor.png 641w, https://tomassetti.me/wp-content/uploads/2017/03/antlr4_parse_tree_visitor-300x110.png 300w, https://tomassetti.me/wp-content/uploads/2017/03/antlr4_parse_tree_visitor-450x165.png 450w" sizes="(max-width: 641px) 100vw, 641px" /></figure></div>
<p>Remember that <strong>this is true for the default implementation of a visitor and it&#8217;s done by returning the children of each node in every function</strong>. If you override a method of the visitor, it&#8217;s your responsibility to make it continuing the journey or stop it right there.</p>
<h2 class="wp-block-heading" id="antlr.js">13. Antlr.js</h2>
<p>It is finally time to see how a typical ANTLR program looks.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="js" data-enlighter-theme data-enlighter-highlight="17-20, 22, 23" data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>import { createServer } from 'http';
import antlr4 from 'antlr4';
const { CommonTokenStream, InputStream } = antlr4;
import ChatLexer from './ChatLexer.js';
import ChatParser from './ChatParser.js';
import HtmlChatListener from './HtmlChatListener.js';

createServer((req, res) => {
   
   res.writeHead(200, {
       'Content-Type': 'text/html',        
   });

   res.write('&lt;html>&lt;head>&lt;meta charset="UTF-8"/>&lt;/head>&lt;body>');
   
   var input = "john SHOUTS: hello @michael /pink/this will work/ :-) \n";
   var chars = new InputStream(input, true)   
   var lexer = new ChatLexer(chars);
   var tokens  = new CommonTokenStream(lexer);
   var parser = new ChatParser(tokens);
      
   parser.buildParseTrees = true;   
   var tree = parser.chat();   
   var htmlChat = new HtmlChatListener(res);
   antlr4.tree.ParseTreeWalker.DEFAULT.walk(htmlChat, tree);
   
   res.write('&lt;/body>&lt;/html>');
   res.end();

}).listen(1337);</pre>
<p>At the beginning of the main file we import the necessary libraries and file, <code>antlr4</code>&nbsp;(the runtime) and our generated parser, plus the listener that we are going to see later.</p>
<p>For simplicity, we get the input from a string, while in a real scenario it would come from an editor.</p>
<blockquote class="wp-block-quote"><p>Lines 17-20 shows the foundation of every ANTLR program: you create the stream of chars from the input, you give it to the lexer and it transforms them in tokens, that are then interpreted by the parser.</p></blockquote>
<p>It is useful to take a moment to reflect on this: the lexer works on the characters of the input, a copy of the input to be precise, while the parser works on the tokens generated by the lexer. <strong>The lexer does not work on the input directly, and the parser does not even see the characters</strong>.</p>
<p>This is important to remember in case you need to do something advanced like manipulating the input. In this case the input is a string, but, of course, it could be any stream of content.</p>
<p>The line 22 is redundant, since the option already defaults to true, but it shows that you can enable or disable it.</p>
<p>Then, on line 23, we set the root node of the tree as a <strong>chat</strong> rule. You want to invoke the parser specifying a rule, which typically is the first rule. However, you can actually invoke any rule directly, like <strong>color</strong>.</p>
<p>Once we get the parse tree from the parser, typically we want to process it using a listener or a visitor. In this case we specify a listener. Our particular listener takes a parameter: the response object. We want to use it to put some text in the response to send to the user. After setting the listener up, we finally walk the tree with our listener.</p>
<h2 class="wp-block-heading" id="htmlchatlistener.js">14. HtmlChatListener.js</h2>
<p>We continue by looking at the listener for our <em>Chat</em> project.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="js" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>import antlr4 from 'antlr4';
import ChatLexer from './ChatLexer.js';
import ChatParser from './ChatParser.js';
import ChatListener  from './ChatListener.js';

export default class HtmlChatListener extends ChatListener {    
    constructor(res) {
		super();
		this.Res = res;
	}
    
    enterName(ctx) {          
        this.Res.write("&lt;strong>");    
    }
    
    exitName(ctx) {      
        this.Res.write(ctx.WORD().getText());
        this.Res.write("&lt;/strong> ");
    }
        
    exitEmoticon(ctx) {      
        var emoticon = ctx.getText();        
        
        if(emoticon == ':-)' || emoticon == ':)')
        {        
            ctx.text = "ðŸ™‚";
        }
        
        if(emoticon == ':-(' || emoticon == ':(')
        {          
            ctx.text = "ðŸ™";
        }

        this.Res.write(ctx.text);
    }   
    
    enterCommand(ctx) {          
        if(ctx.SAYS() != null)
            this.Res.write(ctx.SAYS().getText() + ':' + '&lt;p>');
    
        if(ctx.SHOUTS() != null)
            this.Res.write(ctx.SHOUTS().getText() + ':' + '&lt;p style="text-transform: uppercase">');
    }

    exitLine(ctx) {              
	this.Res.write("&lt;/p>");
    }
}</pre>
<p>After the required function calls, we make our <strong>HtmlChatListener</strong> to extend <strong>ChatListener. </strong>The interesting stuff starts at line 12.</p>
<p>The <strong>ctx</strong> argument is an instance of a specific class context for the node that we are entering/exiting. So for <code>enterName</code> is <code>NameContext</code>, for <code>exitEmoticon</code> is <code>EmoticonContext</code>, etc. This specific context will have the proper elements for the rule, that would make possible to easily access the respective tokens and sub-rules. For example, <code>NameContext</code> will contain fields like <strong>WORD()</strong> and <strong>WHITESPACE();</strong> <code>CommandContext </code>will contain fields like <strong>WHITESPACE()</strong>, <strong>SAYS()</strong> and <strong>SHOUTS().</strong></p>
<blockquote class="wp-block-quote"><p>These functions, <code>enter*</code> and <code>exit*,</code> are called by the walker every time the corresponding nodes are entered or exited while it&#8217;s traversing the AST that represents the program newline. A listener allows you to execute some code, but it&#8217;s important to remember that<strong> you cannot stop the execution of the walker and the execution of the functions</strong>.</p></blockquote>
<p>On line 13, we start by printing a <code>strong</code> tag because we want the name to be bold, then on exitName we take the text from the token <strong>WORD</strong> and close the tag. Note that we ignore the <strong>WHITESPACE</strong> token, nothing says that we have to show everything. In this case we could have done everything either on the enter or exit function, since nothing is happening in between them.</p>
<p>On the function <em>exitEmoticon</em> we simply transform the emoticon text into an emoji character. We get the text of the whole rule because there are no tokens defined for this parser rule. On <em>enterCommand</em>, instead there could be any of two tokens <strong>SAYS</strong> or <strong>SHOUTS</strong>, so we check which one is defined. And then we alter the following text, by transforming in uppercase, if it&#8217;s a <strong>SHOUT. </strong>Note that we close the <code>p</code>&nbsp;tag at the exit of the <strong>line</strong> rule, because the command, semantically speaking, alter all the text of the message.</p>
<p>All we have to do now is launch node, with <code>node antlr.js</code>, and point our browser at its address, usually at <code>http://localhost:1337/</code> and we will be greeted with the following image.</p>
<div class="wp-block-image"><figure class="aligncenter"><img loading="lazy" decoding="async" width="315" height="167" src="https://tomassetti.me/wp-content/uploads/2017/01/Istantanea_javascript_1.png" alt="Output of the HtmlChatListener" class="wp-image-2995" srcset="https://tomassetti.me/wp-content/uploads/2017/01/Istantanea_javascript_1.png 315w, https://tomassetti.me/wp-content/uploads/2017/01/Istantanea_javascript_1-300x159.png 300w" sizes="(max-width: 315px) 100vw, 315px" /></figure></div>
<p>So all is good, we just have to add all the different listeners to handle the rest of the language. Let&#8217;s start with <strong>color</strong> and <strong>message</strong>.</p>
<h2 class="wp-block-heading" id="working-with-a-listener">15. Working with a Listener</h2>
<p>We have seen how to start defining a listener. Now let&#8217;s get serious and see how to evolve in a complete, robust listener. Let&#8217;s start by adding support for <strong>color</strong> and checking the results of our hard work.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="js" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>enterColor(ctx) {   
    var color = ctx.WORD().getText();         
    this.Res.write('&lt;span style="color: ' + color + '">');        
}

exitColor(ctx) {        
    this.Res.write("&lt;/span>");    
}

exitMessage(ctx) {             
    this.Res.write(ctx.getText());
}</pre>
<div class="wp-block-image"><figure class="aligncenter"><img loading="lazy" decoding="async" width="570" height="180" src="https://tomassetti.me/wp-content/uploads/2017/01/Istantanea_javascript_2.png" alt="Output of the HtmlChatListener with errors" class="wp-image-2996" srcset="https://tomassetti.me/wp-content/uploads/2017/01/Istantanea_javascript_2.png 570w, https://tomassetti.me/wp-content/uploads/2017/01/Istantanea_javascript_2-300x95.png 300w, https://tomassetti.me/wp-content/uploads/2017/01/Istantanea_javascript_2-450x142.png 450w" sizes="(max-width: 570px) 100vw, 570px" /></figure></div>
<p>Except that it does not work. Or maybe it works too much: we are writing some part of <strong>message</strong> twice (&#8220;this will work&#8221;): first when we check the specific nodes, which are children of <strong>message</strong>, and then at the end. We are also writing the emoticon out of order: that is because we are writing that directly instead of waiting for the end of message.</p>
<p>Luckily with JavaScript we can dynamically alter objects, so we can take advantage of this fact to change the <code>*Context</code> object themselves.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="js" data-enlighter-theme data-enlighter-highlight="23-28" data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>enterColor(ctx) {     
    var color = ctx.WORD().getText();             
    ctx.text = '&lt;span style="color: ' + color + '">';
}

exitColor(ctx) {
    ctx.text += ctx.message().text;    
    ctx.text += '&lt;/span>';
}

exitEmoticon(ctx) {      
    var emoticon = ctx.getText();        
    
    if(emoticon == ':-)' || emoticon == ':)')
    {        
        ctx.text = "ðŸ™‚";
    }
    
    if(emoticon == ':-(' || emoticon == ':(')
    {          
        ctx.text = "ðŸ™";
    }
}

exitMessage(ctx) {                
    var text = '';

    for (var index = 0; index &lt;  ctx.children.length; index++ ) {
        if(ctx.children[index].text != null)
            text += ctx.children[index].text;
        else
            text += ctx.children[index].getText();
    }

    if(ctx.parentCtx instanceof ChatParser.LineContext == false)
    {
        ctx.text = text;        
    }    
    else
    {
        this.Res.write(text);
        this.Res.write("&lt;/p>");
    }
}</pre>
<p>Only the modified parts are shown in the snippet above. We add a <strong>text</strong> field to every node that transforms its text, and then at the exit of every <strong>message </strong>we print the text if it is the primary message, the one that is directly child of the <strong>line</strong> rule. If it is a message, that is also a child of color, we add the <strong>text </strong>field to the node we are exiting and let <strong>color</strong> print it. We check this on line 30, where we look at the parent node to see if it&#8217;s an instance of the object <code>LineContext</code>. This is also further evidence of how each <strong>ctx</strong> argument corresponds to the proper type.</p>
<p>Between lines 23 and 28 we can see another field of every node of the generated tree: <code>children</code>, which obviously contains the children node. You can observe that if a field<strong> text</strong> exists, we add it to the proper variable, otherwise we use the usual function to get the text of the node.</p>
<h2 class="wp-block-heading" id="solving-ambiguities-with-semantic-predicates">16. Solving Ambiguities with Semantic Predicates</h2>
<p>So far we have seen how to build a parser for a chat language in JavaScript. Let&#8217;s continue working on this grammar but switch to Python. Remember that all code is available in the <a href="https://github.com/gabriele-tomassetti/antlr-mega-tutorial">repository</a>. Before that, we have to solve an annoying problem: the <strong>TEXT</strong> token. The solution &nbsp;we have &nbsp;is terrible, and furthermore, if we tried to get the text of the token, we would have to trim the edges, parentheses or square brackets. So what can we do?</p>
<p>We can use a particular feature of ANTLR called <em>semantic predicates.</em> As the name implies, they are expressions that produce a boolean value. They selectively enable or disable the following rule and thus permit to solve ambiguities. Another reason why they could be used is to support different versions of the same language, for instance a version with a new construct or an old without it.</p>
<p>Technically, they are part of the larger group of <em>actions</em>, that allows to embed arbitrary code into the grammar. <strong>The downside is that the grammar is no more language independent</strong>, since the code in the action must be valid for the target language. For this reason, usually it is considered a good idea to only use semantic predicates when they cannot be avoided, and leave most of the code to the visitor/listener.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>link                : '[' TEXT ']' '(' TEXT ')';

TEXT                : {self._input.LA(-1) == ord('[') or self._input.LA(-1) == ord('(')}? ~[\])]+ ;</pre>
<p>We restored <strong>link</strong> to its original formulation, but we added a semantic predicate to the <strong>TEXT</strong> token, written inside curly brackets and followed by a question mark. We use <code>self._input.LA(-1)</code> to check the character before the current one, if this character is a square bracket or the open parenthesis, we activate the <strong>TEXT</strong> token. It is important to repeat that this must be valid code in our target language, since it is going to end up in the generated Lexer or Parser, in our case in <code>ChatLexer.py.</code></p>
<p>This&nbsp;matters not just for the syntax itself, but also because different targets might have different fields or methods, for instance <code>LA</code> returns an <code>int</code> in python, so we have to convert the <code>char</code> to a <code>int</code>.</p>
<p>Let&#8217;s look at the equivalent form in other languages.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>// C#. Notice that is .La and not .LA
TEXT : {_input.La(-1) == '[' || _input.La(-1) == '('}? ~[\])]+ ;
// Java
TEXT : {_input.LA(-1) == '[' || _input.LA(-1) == '('}? ~[\])]+ ;
// JavaScript
TEXT : {this._input.LA(-1) == '['.charCodeAt(0) || this._input.LA(-1) == '('.charCodeAt(0)}? ~[\])]+ ;</pre>
<p>If you want to test for the preceding token, you can use the <code>_input.LT(-1)</code>, but you can only do that for parser rules. For example, if you want to enable the <strong>mention</strong> rule only if preceded by a <strong>WHITESPACE</strong> token.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>// C#
mention: {_input.Lt(-1).Type == WHITESPACE}? '@' WORD ;
// Java
mention: {_input.LT(-1).getType() == WHITESPACE}? '@' WORD ;
// Python
mention: {self._input.LT(-1).text == ' '}? '@' WORD ;
// JavaScript
mention: {this._input.LT(-1).text == ' '}? '@' WORD ;</pre>
<h2 class="wp-block-heading" id="starting-with-python">17. Continuing the Chat in Python</h2>
<p>Before seeing the Python example, we must modify our grammar and put the <strong>TEXT</strong> token before the <strong>WORD</strong> one. Otherwise ANTLR might assign the incorrect token, in cases where the characters between parentheses or brackets are all valid for <strong>WORD</strong>, for instance if it where <code>[this](link)</code>.</p>
<p>Using ANTLR in python is not more difficult than with any other platform, you just need to pay attention to the version of Python, 2 or 3.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>antlr4 -Dlanguage=Python3 Chat.g4</pre>
<p>And that&#8217;s it. So when you have run the command, inside the directory of your python project, there will be a newly generated parser and a&nbsp;lexer. You may find interesting to look at <code>ChatLexer.py</code> and in particular the function <code>TEXT_sempred </code>(sempred stands for <strong>sem</strong>antic <strong>pred</strong>icate).</p>
<pre class="EnlighterJSRAW" data-enlighter-language="python" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>def TEXT_sempred(self, localctx:RuleContext, predIndex:int):
    if predIndex == 0:
        return self._input.LA(-1) == ord('[') or self._input.LA(-1) == ord('(')</pre>
<p>You can see our predicate right in the code. This also means that you have to check that the correct requirements are available to the generated parser. For instance, you need to import somewhere in the lexer any necessary library for the functions used in the predicate.</p>
<h2 class="wp-block-heading" id="the-python-way">18. The Python Way of Working with a Listener</h2>
<p>The main file of a Python project is very similar to a JavaScript one, <em>mutatis mutandis </em>of course. That is to say we have to adapt libraries and functions to the proper version for a different language.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="python" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>import sys
from antlr4 import *
from ChatLexer import ChatLexer
from ChatParser import ChatParser
from HtmlChatListener import HtmlChatListener

def main(argv):
    input = FileStream(argv[1])
    lexer = ChatLexer(input)
    stream = CommonTokenStream(lexer)
    parser = ChatParser(stream)
    tree = parser.chat()

    output = open("output.html","w")
    
    htmlChat = HtmlChatListener(output)
    walker = ParseTreeWalker()
    walker.walk(htmlChat, tree)
        
    output.close()      

if __name__ == '__main__':
    main(sys.argv)</pre>
<p>We have also changed the input and output to become files, this avoids the need to launch a server in Python. This also solves the issue that the default terminal in Windows supports only some characters (i.e., not Unicode).</p>
<pre class="EnlighterJSRAW" data-enlighter-language="python" data-enlighter-theme data-enlighter-highlight="35-36" data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>import sys
from antlr4 import *
from ChatParser import ChatParser
from ChatListener import ChatListener

class HtmlChatListener(ChatListener) :
    def __init__(self, output):
        self.output = output
        self.output.write('&lt;html>&lt;head>&lt;meta charset="UTF-8"/>&lt;/head>&lt;body>')

    def enterName(self, ctx:ChatParser.NameContext) :
        self.output.write("&lt;strong>") 

    def exitName(self, ctx:ChatParser.NameContext) :
        self.output.write(ctx.WORD().getText()) 
        self.output.write("&lt;/strong> ") 

    def enterColor(self, ctx:ChatParser.ColorContext) :
        color = ctx.WORD().getText()
        ctx.text = '&lt;span style="color: ' + color + '">'        

    def exitColor(self, ctx:ChatParser.ColorContext):         
        ctx.text += ctx.message().text
        ctx.text += '&lt;/span>'

    def exitEmoticon(self, ctx:ChatParser.EmoticonContext) : 
        emoticon = ctx.getText()

        if emoticon == ':-)' or emoticon == ':)' :
            ctx.text = "ðŸ™‚"
    
        if emoticon == ':-(' or emoticon == ':(' :
            ctx.text = "ðŸ™"

    def enterLink(self, ctx:ChatParser.LinkContext):
        ctx.text = '&lt;a href="%s">%s&lt;/a>' % (ctx.TEXT()[1], (ctx.TEXT()[0]))

    def exitMessage(self, ctx:ChatParser.MessageContext):
        text = ''

        for child in ctx.children:
            if hasattr(child, 'text'):
                text += child.text
            else:
                text += child.getText()
        
        if isinstance(ctx.parentCtx, ChatParser.LineContext) is False:
            ctx.text = text
        else:    
            self.output.write(text)
            self.output.write("&lt;/p>") 

    def enterCommand(self, ctx:ChatParser.CommandContext):
        if ctx.SAYS() is not None :
            self.output.write(ctx.SAYS().getText() + ':' + '&lt;p>')

        if ctx.SHOUTS() is not None :
            self.output.write(ctx.SHOUTS().getText() + ':' + '&lt;p style="text-transform: uppercase">')    

    def exitChat(self, ctx:ChatParser.ChatContext):
        self.output.write("&lt;/body>&lt;/html>")</pre>
<p>Apart from lines 35-36, in which we introduce support for links, there is nothing new. Though you might notice that Python syntax is cleaner and, while having dynamic typing, it is not loosely typed as JavaScript. The different types of <code>*Context</code> objects are explicitly written out. If only Python tools were as easy to use as the language itself. But of course we cannot just fly over python like this, so we also introduce testing.</p>
<h2 class="wp-block-heading" id="testing-with-python">19. Testing with Python</h2>
<p>While Visual Studio Code has a very nice extension for Python that also supports unit testing, we are going to use the command line for the sake of compatibility.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>python3 -m unittest discover -s . -p ChatTests.py</pre>
<p>That&#8217;s how you run the tests, but before that, we have to write them. Actually, even before that, we have to write an <code>ErrorListener</code> to manage errors that we could find. While we could simply read the text outputted by the default error listener, there is an advantage in using our own implementation, namely that we can control more easily what happens.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="python" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>import sys
from antlr4 import *
from ChatParser import ChatParser
from ChatListener import ChatListener
from antlr4.error.ErrorListener import *
import io

class ChatErrorListener(ErrorListener):

    def __init__(self, output):
        self.output = output        
        self._symbol = ''
    
    def syntaxError(self, recognizer, offendingSymbol, line, column, msg, e):        
        self.output.write(msg)
        self._symbol = offendingSymbol.text

    @property        
    def symbol(self):
        return self._symbol</pre>
<p>Our class derives from <code>ErrorListener</code> and we simply have to implement <code>syntaxError</code>. Although we also add a property <strong>symbol </strong>to easily check which symbol might have caused an error.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="python" data-enlighter-theme data-enlighter-highlight="19-21, 28" data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>from antlr4 import *
from ChatLexer import ChatLexer
from ChatParser import ChatParser
from HtmlChatListener import HtmlChatListener
from ChatErrorListener import ChatErrorListener
import unittest
import io

class TestChatParser(unittest.TestCase):

    def setup(self, text):        
        lexer = ChatLexer(InputStream(text))        
        stream = CommonTokenStream(lexer)
        parser = ChatParser(stream)
        
        self.output = io.StringIO()
        self.error = io.StringIO()

        parser.removeErrorListeners()        
        errorListener = ChatErrorListener(self.error)
        parser.addErrorListener(errorListener)  

        self.errorListener = errorListener              
        
        return parser
        
    def test_valid_name(self):
        parser = self.setup("John ")
        tree = parser.name()               
    
        htmlChat = HtmlChatListener(self.output)
        walker = ParseTreeWalker()
        walker.walk(htmlChat, tree)              

        # let's check that there aren't any symbols in errorListener         
        self.assertEqual(len(self.errorListener.symbol), 0)

    def test_invalid_name(self):
        parser = self.setup("Joh-")
        tree = parser.name()               
    
        htmlChat = HtmlChatListener(self.output)
        walker = ParseTreeWalker()
        walker.walk(htmlChat, tree)              

        # let's check the symbol in errorListener
        self.assertEqual(self.errorListener.symbol, '-')

if __name__ == '__main__':
    unittest.main()</pre>
<p>The <code>setup</code> method is used to ensure that everything is properly set; on lines 19-21 we setup also our <code>ChatErrorListener</code>, but first we remove the default one, otherwise it would still output errors on the standard output. We are listening to errors in the parser, but we could also catch errors generated by the lexer. It depends on what you want to test. You may want to check both.</p>
<p>The two proper test methods check for a valid and an invalid name. The checks are linked to the property <strong>symbol</strong>, that we have previously defined, if it&#8217;s empty everything is fine, otherwise it contains the symbol that created the error. Notice that on line 28, there is a space at the end of the string, because we have defined the rule <strong>name </strong>to end with a <strong>WHITESPACE</strong> token.</p>
<h2 class="wp-block-heading" id="parsing-markup">20. Parsing Markup</h2>
<p>ANTLR can parse many things, including binary data, in that case tokens are made up of non-printable characters. But a more common problem is parsing markup languages such as XML or HTML. Markup is also a useful format to adopt for your own creations, because it allows to mix unstructured text content with structured annotations. They fundamentally represent a form of smart document, containing both text and structured data. The technical term that describes them is <em>island languages</em>. The term is not restricted to include only markup languages, and it is sometimes a matter of perspective.</p>
<p>For example, you may have to build a parser that only deal with preprocessor directives. In that case, you have to find a way to distinguish proper code from directives, which obeys different rules. In such an example the preprocessor directives might be considered an island language, a separate language surrounded by meaningless (for parsing purposes) text.</p>
<p>In any case, the problem for parsing such languages is that there is a lot of text that we do not actually have to parse, but we cannot ignore or discard, because the text contains useful information for the user and it is a structural part of the document. The solution is <em>lexical modes</em>, a way to parse structured content inside a larger sea of free text.</p>
<h2 class="wp-block-heading" id="lexical-modes">21. Lexical Modes</h2>
<p>We are going to see how to use lexical modes, by starting with a new grammar.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight="3, 7, 9" data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>lexer grammar MarkupLexer;

OPEN                : '[' -> pushMode(BBCODE) ;
TEXT                : ~('[')+ ;

// Parsing content inside tags
mode BBCODE;

CLOSE               : ']' -> popMode ;
SLASH               : '/' ;
EQUALS              : '=' ;
STRING              : '"' .*? '"' ;
ID                  : LETTERS+ ;
WS                  : [ \t\r\n] -> skip ;

fragment LETTERS    : [a-zA-Z] ;</pre>
<p>Looking at the first line you could notice a difference: we are defining a <code>lexer grammar</code>, instead of the usual <code>(combined) grammar</code>. <strong>You simply cannot define a lexical mode together with a parser grammar</strong>. You can use lexical modes only in a lexer grammar, not in a combined grammar. The rest is not surprising, as you can see, we are defining a sort of <a href="https://en.wikipedia.org/wiki/BBCode">BBCode</a> markup, with tags delimited by square brackets.</p>
<p>On lines 3, 7 and 9 you will find basically all that you need to know about lexical modes. You define one or more tokens that can delimit the different modes and activate them.</p>
<p>The default mode is already implicitly defined, if you need to define yours you simply use <code>mode</code> followed by a name. Other than for markup languages, <em>lexical modes </em>are typically used to deal with string interpolation. That is when a string literal can contain more than simple text, for instance arbitrary expressions.</p>
<p>When we used combined grammar, we could define tokens implicitly: that is what happened when we used a string like <code>'='</code> in a parser rule. Now that we are using separate lexer and parser grammars we cannot do that. That means that every single token has to be defined explicitly. So we have definitions like SLASH or EQUALS which typically could just be directly used in a parser rule. The concept&nbsp;is simple:&nbsp;<strong>in the lexer grammar, we need to define all tokens, because they cannot be defined later in the parser grammar.</strong></p>
<h2 class="wp-block-heading" id="parser-grammars">22. Parser Grammars</h2>
<p>We look at the other side of a lexer grammar, so to speak.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>parser grammar MarkupParser;

options { tokenVocab=MarkupLexer; }

file        : element* ;

attribute   : ID '=' STRING ; 

content     : TEXT ;

element     : (content | tag) ;

tag         : '[' ID attribute? ']' element* '[' '/' ID ']' ;</pre>
<p>On the first line we define a <code>parser grammar</code>. Since the tokens we need are defined in the lexer grammar, we need to use an option to say to ANTLR where it can find them. This is not necessary in combined grammars, since the tokens are defined in the same file.</p>
<p>There are many other options available, in the <a href="https://github.com/antlr/antlr4/blob/master/doc/options.md">documentation</a>.</p>
<p>There is almost nothing else to add, except that we define a <strong>content</strong> rule so that we can manage more easily the text that we find later in the program.</p>
<p>I just want to say that, as you can see, we do not need to explicitly use the tokens every time (e.g., SLASH), but instead we can use the corresponding text (e.g., <code>'/'</code>).</p>
<p>ANTLR will automatically transform the text in the corresponding token, but this can happen only if they are already defined. In short, it is as if we had written:</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>tag : OPEN ID attribute? CLOSE element* OPEN SLASH ID CLOSE ;</pre>
<p>But we could not have used the implicit way, if we had not already explicitly defined them in the lexer grammar. Another way to look at this is: when we define a combined grammar, ANTLR defines for us all the tokens that we have not explicitly defined ourselves. When we need to use a separate lexer and a parser grammar, we have to define explicitly every token ourselves. Once we have done that, we can use them in every way we want.</p>
<p>Before moving to actual Java code, let&#8217;s see the parse tree for a sample input.</p>
<div class="wp-block-image"><figure class="aligncenter"><img loading="lazy" decoding="async" width="939" height="198" src="https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_2.png" alt="Sample parse tree of the Markup parser" class="wp-image-3005" srcset="https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_2.png 939w, https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_2-300x63.png 300w, https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_2-768x162.png 768w, https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_2-705x149.png 705w, https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_2-450x95.png 450w" sizes="(max-width: 939px) 100vw, 939px" /></figure></div>
<p>You can easily notice that the <strong>element</strong> rule is sort of transparent: where you would expect to find it there is always going to be a <strong>tag</strong> or <strong>content</strong>. So why did we define it? There are two advantages: avoid repetition in our grammar and simplify managing the results of the parsing.</p>
<p>We avoid repetition because if we did not have the element rule, we should repeat&nbsp;<code>(content|tag)</code> everywhere it is used. What if one day we add a new type of element? In addition to that, it simplifies the processing of the parse tree, because it makes easy to act upon both tag and content, given that you can use their common ancestor (<code>element</code>).</p>
<h2 class="wp-block-heading">Advanced</h2>
<div class="gb-container gb-container-c48eed81"><div class="gb-inside-container">
<div class="wp-block-columns is-layout-flex wp-container-core-columns-layout-4 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<div class="wp-block-columns is-layout-flex wp-container-core-columns-layout-3 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow" style="flex-basis:33.33%">
<figure class="wp-block-image size-large"><img loading="lazy" decoding="async" width="727" height="1030" src="https://tomassetti.me/wp-content/uploads/2022/01/ANTLR_FAQ_Table_of_Contents-727x1030.png" alt="ANTLR FAQ Table of Contents" class="wp-image-7171" srcset="https://tomassetti.me/wp-content/uploads/2022/01/ANTLR_FAQ_Table_of_Contents-727x1030.png 727w, https://tomassetti.me/wp-content/uploads/2022/01/ANTLR_FAQ_Table_of_Contents-212x300.png 212w, https://tomassetti.me/wp-content/uploads/2022/01/ANTLR_FAQ_Table_of_Contents-768x1088.png 768w, https://tomassetti.me/wp-content/uploads/2022/01/ANTLR_FAQ_Table_of_Contents-1085x1536.png 1085w, https://tomassetti.me/wp-content/uploads/2022/01/ANTLR_FAQ_Table_of_Contents.png 1281w" sizes="(max-width: 727px) 100vw, 727px" /></figure>
</div>
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow" style="flex-basis:66.66%">
<p style="font-size:30px"><strong>Your ANTLR Questions Answered</strong></p>
<p>A collection of answers to common issues that you encounter and useful patterns that you can use when creating ANTLR parsers.</p>
<p>We also included a cheatsheet for ANTLR that you can use as an handy reference.</p>
</div>
</div>
<div class="wp-block-buttons is-content-justification-center is-layout-flex wp-container-core-buttons-layout-2 wp-block-buttons-is-layout-flex">
<div class="wp-block-button is-style-fill"><a class="wp-block-button__link" href="https://strumenta.com/antlr-faq/" rel>Learn More About the ANTLR FAQ</a></div>
</div>
</div>
</div>
</div><div class="gb-shapes"><div class="gb-shape gb-shape-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 211.2" preserveAspectRatio="none"><path d="M600 188.4C321.1 188.4 84.3 109.5 0 0v211.2h1200V0c-84.3 109.5-321.1 188.4-600 188.4z" /></svg></div></div></div>
<p>In this section we deepen our understanding of ANTLR. We will look at more complex examples and situations we may have to handle in our parsing adventures. We will learn how to perform more advanced testing, to catch more bugs and ensure a better quality for our code. We will see what a visitor is and how to use it. Finally, we will see how to deal with expressions and the complexity they bring.<br>You can come back to this section when you need to deal with complex parsing problems.</p>
<h2 class="wp-block-heading" id="setup-java-for-antlr">23. The Markup Project in Java</h2>
<p>You can follow the instructions in <a href="#java-setup">Java Setup</a> or just copy the<code> antlr-java</code> folder of the companion repository. Once the file <code>build.gradle</code> is properly configured, this is how you build and execute the application.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group># use gradle to build the project
./gradlew compileJava
# if you are not using an IDE
# and you have defined the fatJar task as in the repository
./gradlew fatJar
java -jar .\build\libs\markup-example-gradle-all.jar </pre>
<p>As you can see, it is not any different from any typical Gradle project, although it is indeed more complicated than a typical JavaScript or Python project. Of course, if you use an IDE, you do not need to do anything different from your typical workflow.</p>
<h2 class="wp-block-heading" id="the-main-app.java">24. The Main App.java</h2>
<p>We are going to see how to write a typical ANTLR application in Java.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="java" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>package me.tomassetti.examples.MarkupParser;
import org.antlr.v4.runtime.*;
import org.antlr.v4.runtime.tree.*;

public class App 
{
    public static void main( String[] args )
    {
        CharStream inputStream = CharStreams.fromString(
            "I would like to [b][i]emphasize[/i][/b] this and [u]underline [b]that[/b][/u] ." +
            "Let's not forget to quote: [quote author=\"John\"]You're wrong![/quote]");
        MarkupLexer markupLexer = new MarkupLexer(inputStream);
        CommonTokenStream commonTokenStream = new CommonTokenStream(markupLexer);
        MarkupParser markupParser = new MarkupParser(commonTokenStream);

        MarkupParser.FileContext fileContext = markupParser.file();                
        MarkupVisitor visitor = new MarkupVisitor();                
        visitor.visit(fileContext);        
    }
}</pre>
<p>There is a small surprise regarding the <code>inputStream</code> variable. Instead of using an <code>[ANTLR]InputStream</code> class we are using a <code>CharStream</code> one. This difference applies to Java and C# and it is due to Unicode support. The gist is that previous version of the runtimes for these languages supported only partially Unicode, so to avoid any surprising change in behavior the old [ANTLR]InputStream was deprecated. You can read more on the <a href="https://github.com/antlr/antlr4/blob/master/doc/unicode.md">official ANTLR documentation</a>.</p>
<p>Apart from this change, at this point the main java file should not come as a surprise: the only new development is the visitor. Of course, there are the obvious little differences in the names of the ANTLR classes and such. This time we are building a visitor, whose main advantage is the chance to control the flow of the program. While we are still dealing with text, we do not want to display it, we want to transform it from pseudo-BBCode to pseudo-Markdown.</p>
<h2 class="wp-block-heading" id="transforming-code-with-antlr">25. Transforming Code with ANTLR</h2>
<p>The first issue to deal with our translation from&nbsp;pseudo-BBCode to pseudo-Markdown is a design decision. Our two languages are different and frankly neither of the two original ones is that well designed.</p>
<p>BBCode was created as a safety precaution, to make possible to disallow the use of HTML but give some of its power to users. Markdown was created to be an easy to read and write format, that could be translated into HTML. So they both mimic HTML, and you can actually use HTML in a Markdown document. Let&#8217;s start looking into how messy a real conversion would be.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="java" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>package me.tomassetti.examples.MarkupParser;

import org.antlr.v4.runtime.*;
import org.antlr.v4.runtime.misc.*;
import org.antlr.v4.runtime.tree.*;

public class MarkupVisitor extends MarkupParserBaseVisitor&lt;String>
{
    @Override
    public String visitFile(MarkupParser.FileContext context)
    {
         visitChildren(context);
         
         System.out.println("");
         
         return null;
    }
    
    @Override
    public String visitContent(MarkupParser.ContentContext context)
    {
        System.out.print(context.TEXT().getText());
        
        return visitChildren(context);
    }
}</pre>
<p>The first version of our visitor prints all the text and ignore all the tags.</p>
<p>You can see how to control the flow, either&nbsp;by calling <code>visitChildren</code>, or any other <code>visit*</code> function, and deciding what to return. We just need to override the methods&nbsp;that we want to change. Otherwise, the default implementation would just do like <code>visitContent</code>, on line 24, it will visit the children nodes and allow the visitor to continue. Just like for a listener, the argument is the proper context type. If you want to stop the visitor, just return null as on line 16.</p>
<h2 class="wp-block-heading" id="joy-and-pain-of-transforming-code">26. Joy and Pain of Transforming Code</h2>
<p>Transforming code, even at a very simple level, comes with some complications. Let&#8217;s start easy with some basic visitor methods.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="java" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>@Override
public String visitContent(MarkupParser.ContentContext context)    
{          
    return context.getText();        
}    

@Override
public String visitElement(MarkupParser.ElementContext context)
{
    if(context.parent instanceof MarkupParser.FileContext)
    {
        if(context.content() != null)            
            System.out.print(visitContent(context.content()));            
        if(context.tag() != null)
            System.out.print(visitTag(context.tag()));
    }    

    return null;
}</pre>
<p>Before looking at the main method, let&#8217;s look at the supporting ones. Foremost, we have changed <code>visitContent</code> by making it return its text instead of printing it. Second, we have overridden the <code>visitElement</code> so that it prints the text of its child, but only if it is a top element, and not inside a <strong>tag</strong>. In both cases, it achieves this by calling the proper <code>visit*</code> method. It knows which one to call because it checks if it actually has a <strong>tag</strong> or <strong>content</strong> node.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="java" data-enlighter-theme data-enlighter-highlight="14-15, 18-22, 28-34" data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>@Override
public String visitTag(MarkupParser.TagContext context)    
{
    String text = "";
    String startDelimiter = "", endDelimiter = "";

    String id = context.ID(0).getText();
    
    switch(id)
    {
        case "b":
            startDelimiter = endDelimiter = "**";                
        break;
        case "u":
            startDelimiter = endDelimiter = "*";                
        break;
        case "quote":
            String attribute = context.attribute().STRING().getText();
            attribute = attribute.substring(1,attribute.length()-1);
            startDelimiter = System.lineSeparator() + "> ";
            endDelimiter = System.lineSeparator() + "> " + System.lineSeparator() + "> â€“ "
                         + attribute + System.lineSeparator();
        break;
    } 

    text += startDelimiter;

    for (MarkupParser.ElementContext node: context.element())
    {                
        if(node.tag() != null)
            text += visitTag(node.tag());
        if(node.content() != null)
            text += visitContent(node.content());                
    }        
    
    text += endDelimiter;
    
    return text;        
}</pre>
<p><code>VisitTag</code> contains more code than every other method, because it can also contain other elements, including other tags that have to be managed themselves, and thus they cannot be simply printed. We save the content of the <strong>ID </strong>on line 7, of course we don&#8217;t need to check that the corresponding end tag matches, because the parser will ensure that, as long as the input is well formed.</p>
<p>The first complication starts with at lines 14-15: as it often happens when transforming a language in a different one, there is not a perfect correspondence between the two. While BBCode tries to be a smarter and safer replacement for HTML, Markdown wants to accomplish the same objective of HTML, to create a structured document. So BBCode has an underline tag, while Markdown does not.</p>
<blockquote class="wp-block-quote"><p>So we have to make a decision</p></blockquote>
<p>Do we want to discard the information, or directly print HTML, or something else? We choose something else and instead convert the underline to an italic. That might seem completely arbitrary, and indeed there is an element of choice in this decision. But the conversion forces us to lose some information, and both are used for emphasis, so we choose the closer thing in the new language.</p>
<p>The following case, on lines 18-22, forces us to make another choice. We can&#8217;t maintain the information about the author of the quote in a structured way, so we choose to print the information in a way that will make sense to a human reader.</p>
<p>On lines 28-34 we do our <em>magic</em>: we visit the children and gather their text, then we close with the <strong>endDelimiter</strong>. Finally we return the text that we have created.</p>
<blockquote class="wp-block-quote"><p>That&#8217;s how the visitor works</p></blockquote>
<ol><li>every top<strong> element </strong>visits each child <ul><li>if it&#8217;s a <strong>content</strong> node,&nbsp;it directly returns the text</li><li>if it&#8217;s a <strong>tag</strong>,&nbsp;it setups the correct delimiters and then&nbsp;it checks its children.&nbsp;It repeats step 2 for each child and then it returns the gathered text </li></ul></li><li>it&nbsp;prints the returned text</li></ol>
<p>It is obviously a simple example, but it shows how you can have great freedom in managing the visitor once you have launched it. Together with the patterns that we have seen at the beginning of this section, you can see all of the options: to return null to stop the visit, to return children to continue, to return something to perform an action ordered at a higher level of the tree.</p>
<h2 class="wp-block-heading" id="advanced-testing">27. Advanced Testing</h2>
<p>The use of lexical modes permits handling the parsing of island languages, but it complicates testing.</p>
<p>We are not going to show <code>MarkupErrorListener.java</code> because we did not change it; if you need it, you can see it on the repository.</p>
<p>You can run the tests by using the following command.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>./gradlew test</pre>
<p>Now&nbsp;we are going to look&nbsp;at the tests code. We are skipping the setup part, because that also is obvious, we just copy the process seen on the main file, but we simply add our error listener to intercept the errors.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="java" data-enlighter-theme data-enlighter-highlight="36-38,46" data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>// private variables inside the class AppTest
private MarkupErrorListener errorListener;
private MarkupLexer markupLexer;

 @Test
    public void testText()
    {
        MarkupParser parser = setup("anything in here");

        MarkupParser.ContentContext context = parser.content();        
        
        assertEquals("",this.errorListener.getSymbol());
    }

    @Test
    public void testInvalidText()
    {
        MarkupParser parser = setup("[anything in here");

        MarkupParser.ContentContext context = parser.content();        
        
        // note that this.errorListener.symbol could be empty
        // when ANTLR doesn't recognize the token or there is no error.           
        // In such cases check the output of errorListener        
        assertEquals("[",this.errorListener.getSymbol());
    }

    @Test
    public void testWrongMode()
    {
        MarkupParser parser = setup("author=\"john\"");                

        MarkupParser.AttributeContext context = parser.attribute(); 
        TokenStream ts = parser.getTokenStream();        
        
        assertEquals(MarkupLexer.DEFAULT_MODE, markupLexer._mode);
        assertEquals(MarkupLexer.TEXT,ts.get(0).getType());        
        assertEquals("author=\"john\"",this.errorListener.getSymbol());
    }

    @Test
    public void testAttribute()
    {
        MarkupParser parser = setup("author=\"john\"");
        // we have to manually push the correct mode
        this.markupLexer.pushMode(MarkupLexer.BBCODE);

        MarkupParser.AttributeContext context = parser.attribute(); 
        TokenStream ts = parser.getTokenStream();        
        
        assertEquals(MarkupLexer.ID,ts.get(0).getType());
        assertEquals(MarkupLexer.EQUALS,ts.get(1).getType());
        assertEquals(MarkupLexer.STRING,ts.get(2).getType()); 
        
        assertEquals("",this.errorListener.getSymbol());
    }

    @Test
    public void testInvalidAttribute()
    {
        MarkupParser parser = setup("author=/\"john\"");
        // we have to manually push the correct mode
        this.markupLexer.pushMode(MarkupLexer.BBCODE);
        
        MarkupParser.AttributeContext context = parser.attribute();        
        
        assertEquals("/",this.errorListener.getSymbol());
    }</pre>
<p>The first two methods are exactly as before, we simply check that there are no errors, or that there is the correct one because the input itself is erroneous. On lines 36-38 things start to get interesting: the issue is that by testing the rules one by one, we do not give the chance to the parser to switch automatically to the correct mode. So it remains always on the DEFAULT_MODE, which in our case makes everything looks like <strong>TEXT</strong>. This obviously makes the correct parsing of an <strong>attribute</strong> impossible.</p>
<p>The same lines also show how you can check the current mode that you are in, and the exact type of the tokens that are found by the parser, which we use to confirm that indeed all is wrong in this case.</p>
<p>While we could use a string of text to trigger the correct mode each time, that would make testing intertwined with several pieces of code, which is a no-no. So the solution is seen on line 46: we trigger the correct mode manually. Once you have done that, you can see that our attribute is recognized correctly.</p>
<h2 class="wp-block-heading" id="dealing-with-expressions">28. Dealing with Expressions</h2>
<p>So far we have written simple parser rules, now we are going to see one of the most challenging parts in analyzing a real (programming) language: expressions. While rules for statements are usually larger, they are quite simple to deal with: you just need to write a rule that encapsulate the structure with all the different optional parts. For instance, a <code>for</code> statement can include all other kinds of statements, but we can simply include them with something like <code>statement*. </code>An expression, instead, can be combined in many different ways.</p>
<p>An expression usually contains other expressions. For example, the typical binary expression is composed of an expression on the left, an operator in the middle and another expression on the right. This can lead to ambiguities. Think, for example, at the expression <code>5 + 3 * 2</code>, for ANTLR this expression is ambiguous because there are two ways to parse it. It could either parse it as <code>5 + (3 * 2)</code> or <code>(5 +3) * 2</code>.</p>
<p>Until this moment, we have avoided the problem simply because markup constructs surround the object on which they are applied. So there is not ambiguity in choosing which one to apply first: it is the most external. Imagine if this expression was written as:&nbsp;</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>&lt;add>
    &lt;int>5&lt;/int>
    &lt;mul>
        &lt;int>3&lt;/int>
        &lt;int>2&lt;/int>
    &lt;/mul>
&lt;/add></pre>
<p>That would make obvious to ANTLR how to parse it.</p>
<p>These types of rules are called <em>left-recursive rules. </em>You might say: just parse whatever comes first. The problem with that is semantic: the addition comes first, but we know that multiplications have precedence over additions. Traditionally, the way to solve this problem was to create a complex cascade of specific expressions like this:</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>expression     : addition;
addition       : multiplication ('+' multiplication)* ;
multiplication : atom ('*' atom)* ;
atom           : NUMBER ;</pre>
<p>This way ANTLR would have known to search first for a number, then for multiplications and finally for additions. This is cumbersome and also counterintuitive, because the last expression is the&nbsp;first to be actually recognized. Luckily <strong>ANTLR4 can create a similar structure automatically, so&nbsp;we can use&nbsp;a much more natural syntax</strong>.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>expression : expression '*' expression
           | expression '+' expression                      
           | NUMBER
           ;</pre>
<p>In practice ANTLR consider the order in which we defined the alternatives to decide the precedence. By writing the rule in this way, we are telling to ANTLR that the multiplication takes precedence over the addition.</p>
<h2 class="wp-block-heading" id="parsing-spreadsheets">29. Parsing Spreadsheets</h2>
<p>Now we are prepared to create our last application, in C#. We are going to build &nbsp;the parser of an Excel-like application. In practice, we want to manage the expressions you write in the cells of a spreadsheet.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight="6" data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>grammar Spreadsheet;

expression          : '(' expression ')'                        #parenthesisExp
                    | expression (ASTERISK|SLASH) expression    #mulDivExp
                    | expression (PLUS|MINUS) expression        #addSubExp
                    | &lt;assoc=right>  expression '^' expression  #powerExp
                    | NAME '(' expression ')'                   #functionExp
                    | NUMBER                                    #numericAtomExp
                    | ID                                        #idAtomExp
                    ;

fragment LETTER     : [a-zA-Z] ;
fragment DIGIT      : [0-9] ;

ASTERISK            : '*' ;
SLASH               : '/' ;
PLUS                : '+' ;
MINUS               : '-' ;

ID                  : LETTER DIGIT ;

NAME                : LETTER+ ;

NUMBER              : DIGIT+ ('.' DIGIT+)? ;

WHITESPACE          : ' ' -> skip;</pre>
<p>With all the knowledge you have acquired so far everything should be clear, except for possibly three things:</p>
<ol><li>why the parentheses are there,</li><li>what&#8217;s the stuff on the right,</li><li>that thing on line 6.</li></ol>
<div class="wp-block-image"><figure class="aligncenter"><img loading="lazy" decoding="async" width="812" height="275" src="https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_3.png" alt="Parentheses to change the operator precedence" class="wp-image-3006" srcset="https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_3.png 812w, https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_3-300x102.png 300w, https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_3-768x260.png 768w, https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_3-705x239.png 705w, https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_3-450x152.png 450w" sizes="(max-width: 812px) 100vw, 812px" /></figure></div>
<p>The parentheses come first because their only role is to give the user a way to override the precedence of operator, if they need to do so. This graphical representation of the AST should make it clear.</p>
<p>The things on the right are <em>labels</em>, they are used to make ANTLR generate specific functions for the visitor or listener. So there will be a <code>VisitFunctionExp</code>, a <code>VisitPowerExp</code>, etc. This makes&nbsp;possible to avoid the use of a giant visitor for the <strong>expression</strong> rule.</p>
<p>The expression relative to exponentiation is different because there are two possible ways to act, to group them, when you meet two sequential expressions of the same type. The first one is to execute the one on the left first and then the one on the right, the second one is the inverse: this is called <em>associativity</em>. Usually the one that you want to use is <em>left-associativity,&nbsp;</em> which is the default option. Nonetheless exponentiation is <em>right-associative</em>, so we have to signal this to ANTLR.</p>
<p><strong>Another way to look at this is: if there are two expressions of the same type, which one has the precedence: the left one or the right one?</strong> Again, an image is worth a thousand words.</p>
<div class="wp-block-image"><figure class="aligncenter"><img loading="lazy" decoding="async" width="565" height="240" src="https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_4.png" alt="Associativity of an expression" class="wp-image-3007" srcset="https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_4.png 565w, https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_4-300x127.png 300w, https://tomassetti.me/wp-content/uploads/2017/01/antlr4_parse_tree_4-450x191.png 450w" sizes="(max-width: 565px) 100vw, 565px" /></figure></div>
<p>We also have support for functions, alphanumeric variables that represents cells and real numbers.</p>
<h2 class="wp-block-heading" id="setup-csharp">30. The Spreadsheet Project in C#</h2>
<p>You just need to follow the <a href="#csharp-setup">C# Setup</a>: to install a nuget package for the runtime and an ANTLR4 extension for Visual Studio. The extension will automatically generate everything whenever you build your project: parser, listener and/or visitor.</p>
<p><em>Notice that there are two small differences between the code for a project using the extension and one using the Java tool. These are noted in the <a href="https://github.com/gabriele-tomassetti/antlr-mega-tutorial/blob/master/antlr-csharp/README.md">README for the C# project at the repository</a>.</em></p>
<p>After you have done that, you can also add grammar files just by using the usual menu Add -&gt; New Item. Do exactly that to create a grammar called <code>Spreadsheet.g4</code> and put in it the grammar we have just created. Now let&#8217;s see the main <code>Program.cs</code>.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="csharp" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>using System;
using Antlr4.Runtime;

namespace AntlrTutorial
{
    class Program
    {
        static void Main(string[] args)
        {
            string input = "log(10 + A1 * 35 + (5.4 - 7.4))";

            ICharStream inputStream = CharStreams.fromString(input);
            SpreadsheetLexer spreadsheetLexer = new SpreadsheetLexer(inputStream);
            CommonTokenStream commonTokenStream = new CommonTokenStream(spreadsheetLexer);
            SpreadsheetParser spreadsheetParser = new SpreadsheetParser(commonTokenStream);

            SpreadsheetParser.ExpressionContext expressionContext = spreadsheetParser.expression();
            SpreadsheetVisitor visitor = new SpreadsheetVisitor();
            
            Console.WriteLine(visitor.Visit(expressionContext));
        }
    }
}</pre>
<p>There is nothing to say, apart from that, of course, you have to pay attention to yet another slight variation in the naming of things: pay attention to the casing and interfaces. For instance, <code>ICharStream</code>, in the C# program, was <code>CharStream</code> in the Java program.</p>
<p>Also you can notice that, this time, we output on the screen the result of our visitor, instead of writing the result on a file.</p>
<h2 class="wp-block-heading" id="excel-is-doomed">31. Excel is Doomed</h2>
<p>We are going to take a look at our visitor for the <em>Spreadsheet</em> project.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="csharp" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>public class DoubleSpreadsheetVisitor : SpreadsheetBaseVisitor&lt;double>
{
    private static DataRepository data = new DataRepository();

    public override double VisitNumericAtomExp(SpreadsheetParser.NumericAtomExpContext context)
    {            
        return double.Parse(context.NUMBER().GetText(), System.Globalization.CultureInfo.InvariantCulture);
    }

    public override double VisitIdAtomExp(SpreadsheetParser.IdAtomExpContext context)
    {
        String id = context.ID().GetText();

        return data[id];
    }

    public override double VisitParenthesisExp(SpreadsheetParser.ParenthesisExpContext context)
    {
        return Visit(context.expression());
    }

    public override double VisitMulDivExp(SpreadsheetParser.MulDivExpContext context)
    {
        double left = Visit(context.expression(0));
        double right = Visit(context.expression(1));
        double result = 0;

        if (context.ASTERISK() != null)
            result = left * right;
        if (context.SLASH() != null)
            result = left / right;

        return result;
    }

    [..]

    public override double VisitFunctionExp(SpreadsheetParser.FunctionExpContext context)
    {
        String name = context.NAME().GetText();
        double result = 0;

        switch(name)
        {
            case "sqrt":
                result = Math.Sqrt(Visit(context.expression()));
                break;

            case "log":
                result = Math.Log10(Visit(context.expression()));
                break;
        }

        return result;
    }
}</pre>
<p><code>VisitNumeric</code> and <code>VisitIdAtom</code> return the actual numbers that are represented either by the literal number or the variable. In a real scenario <strong>DataRepository</strong> would contain methods to access the data in the proper cell, but in our example is just a Dictionary with some keys and numbers. The other methods actually work in the same way: they visit/call the containing expression(s). The only difference is what they do with the results.</p>
<p>Some perform an operation on the result, the binary operations combine two results in the proper way and finally <code>VisitParenthesisExp</code> just reports the result higher on the chain. Math is simple, when it is done by a computer.</p>
<h2 class="wp-block-heading" id="testing-everything">32. Testing Everything</h2>
<p>Up until now, we have only tested the parser rules, that is to say we have tested only if we have created the correct rule to parse our input. Now we are also going to test the visitor functions. This is the ideal chance because our visitor returns values that we can check individually. In other occasions, for instance if your visitor prints something to the screen, you may want to rewrite the visitor to write on a stream. Then, at testing time, you can easily capture the output.</p>
<p>We are not going to show <code>SpreadsheetErrorListener.cs</code> because it is the same as the previous one we have already seen; if you need it you can see it on the repository.</p>
<p>To perform unit testing with C#, you need to create a specific project inside the solution. You can choose different formats, we opt for the xUnit version. To run them there is an aptly named section &#8220;TEST&#8221; on the menu bar in Visual Studio or the command <code>dotnet test</code> on the command line.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="csharp" data-enlighter-theme data-enlighter-highlight="11,13,25,27,44-46,59" data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>[Fact]
public void testExpressionPow()
{
    setup("5^3^2");

    PowerExpContext context = parser.expression() as PowerExpContext;

    CommonTokenStream ts = (CommonTokenStream)parser.InputStream;   

    Assert.Equal(SpreadsheetLexer.NUMBER, ts.Get(0).Type);
    Assert.Equal(SpreadsheetLexer.T__2, ts.Get(1).Type);
    Assert.Equal(SpreadsheetLexer.NUMBER, ts.Get(2).Type);
    Assert.Equal(SpreadsheetLexer.T__2, ts.Get(3).Type);
    Assert.Equal(SpreadsheetLexer.NUMBER, ts.Get(4).Type); 
}

[Fact]
public void testVisitPowerExp()
{
    setup("4^3^2");

    PowerExpContext context = parser.expression() as PowerExpContext;

    SpreadsheetVisitor visitor = new SpreadsheetVisitor();
    double result = visitor.VisitPowerExp(context);

    Assert.Equal(double.Parse("262144"), result);
}

[..]

[Fact]
public void testWrongVisitFunctionExp()
{
    setup("logga(100)");

    FunctionExpContext context = parser.expression() as FunctionExpContext;
    
    SpreadsheetVisitor visitor = new SpreadsheetVisitor();
    double result = visitor.VisitFunctionExp(context);

    CommonTokenStream ts = (CommonTokenStream)parser.InputStream;

    Assert.Equal(SpreadsheetLexer.NAME, ts.Get(0).Type);
    Assert.Equal(null, errorListener.Symbol);
    Assert.Equal(0, result);
}

[Fact]
public void testCompleteExp()
{
    setup("log(5+6*7/8)");

    ExpressionContext context = parser.expression();

    SpreadsheetVisitor visitor = new SpreadsheetVisitor();
    double result = visitor.Visit(context);

    Assert.Equal("1.0107238653917732", result.ToString(System.Globalization.CultureInfo.GetCultureInfo("en-US").NumberFormat));            
}</pre>
<p>The first test function is similar to the ones we have already seen; it checks that the correct tokens are selected. On line 11 and 13 you may be surprised to see that weird token type, this happens because we didn&#8217;t explicitly create one for the &#8216;^&#8217; symbol so one got automatically created for us. If you need you can see all the tokens by looking at the *.tokens file generated by ANTLR.</p>
<p>On line 25 we&nbsp;visit our test node and get the results, that we check on line 27. It is all very simple because our visitor is simple. While unit testing should always be easy and made up of small parts it really cannot be easier than this.</p>
<p>The only thing to pay attention to is related to the format of the number; it is not a problem here, but look at line 59, where we test the result of a whole expression. There we need to make sure that the correct format is selected, because different countries use different symbols as the decimal mark.</p>
<blockquote class="wp-block-quote"><p>There are some things that depend on the cultural context</p></blockquote>
<p>If your computer&nbsp;was already&nbsp;set to the&nbsp;<em>American English&nbsp;Culture</em> this would not be necessary, but to guarantee the correct testing results for everybody, we have to specify it. Keep that in mind if you are testing things that are culture-dependent: such as grouping of digits, temperatures, etc.</p>
<p>On line 44-46 you see that when we check for the wrong function the parser actually works. That is because indeed <code>logga</code> is syntactically valid as a function name, but it is not semantically correct. The function <code>logga</code> does not exist, so our program does not know what to do with it. So when we visit it we get 0 as a result. As you recall this was our choice: since we initialize the result to 0 and we do not have a <code>default</code> case in <code>VisitFunctionExp.</code> So if there is no function the result remains 0. A possible alternative could be to throw an exception.</p>
<h2 class="wp-block-heading">Final Remarks</h2>
<p>In this section we see tips and tricks that never came up in our example, but can be useful in your programs. We suggest more resources you may find useful if you want to know more about ANTLR, both the practice and the theory, or you need to deal with the most complex problems.</p>
<h2 class="wp-block-heading" id="tips-and-tricks">33. Tips and Tricks</h2>
<p>Let&#8217;s see a few tricks that could be useful from time to time. These were never needed in our examples, but they have been quite useful in other scenarios.</p>
<h3 class="wp-block-heading">Catchall Rule</h3>
<p>The first one is the&nbsp;<strong>ANY</strong> lexer rule. This is simply a rule in the following format.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>ANY : . ;</pre>
<p>This is a catchall rule that should be put at the end of your grammar. It matches any character that didn&#8217;t find its place during the parsing. So creating this rule can help you&nbsp;during development, when your grammar has still many holes that could cause distracting error messages. It&#8217;s even useful during production, when it acts as a canary in the mines. If it shows up in your program you know that something is wrong.</p>
<h3 class="wp-block-heading">Channels</h3>
<p>There is also something that we have not talked about: <em>channels</em>. Their use case is usually handling comments. You do not really want to check for comments inside every of your statements or expressions, so you usually throw them away with <code>-&gt; skip</code>. But there are some cases where you may want to preserve them, for instance if you are translating a program in another language. When this happens, you use <em>channels</em>. There is already one called <code>HIDDEN</code> that you can use, but you can declare more of them at the top of your lexer grammar.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>channels { UNIQUENAME }
// and you use them this way
COMMENTS : '//' ~[rn]+ -> channel(UNIQUENAME) ;</pre>
<h3 class="wp-block-heading">Rule Element Labels</h3>
<p>There is another use of labels other than to distinguish among different cases of the same rule. They can be used to give a specific name to a common rule or parts of a rule. The format is <code>label=rule</code>, to be used inside another rule.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>expression : left=expression (ASTERISK|SLASH) right=expression ;</pre>
<p>This way <strong>left</strong> and <strong>right</strong> would become fields in the <code>ExpressionContext</code> nodes. And instead of using <code>context.expression(0)</code>, you could refer to the same entity using <code>context.left</code>.</p>
<h3 class="wp-block-heading">Problematic Tokens</h3>
<p>In&nbsp;many real&nbsp;languages a few symbols are reused in different ways, which in some cases may lead to ambiguities.&nbsp;A common problematic example&nbsp;are the angle brackets, used both for bitshift expression and to delimit parameterized types.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>// bitshift expression, it assigns to x the value of y shifted by three bits
x = y >> 3;
// parameterized types, it define x as a list of dictionaries
List&lt;Dictionary&lt;string, int>> x;</pre>
<p>The natural way of defining the bitshift operator token&nbsp;is as a single double angle brackets, <code>&gt;&gt;</code>. But this might lead to confusing a nested parameterized definition with the bitshift operator, for instance in the second example shown up here. While a simple way of solving&nbsp;the problem&nbsp;would be using semantic predicates, an excessive number of them would slow down the parsing phase. The solution is to avoid defining the bitshift operator token and instead using the angle brackets twice in the parser rule, so that the parser itself can choose the best candidate for every occasion.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>// from this
RIGHT_SHIFT : '>>';
expression : ID RIGHT_SHIFT NUMBER;
// to this
expression : ID SHIFT SHIFT NUMBER;
</pre>
<h2 class="wp-block-heading" id="conclusions">34. Conclusions</h2>
<div class="gb-container gb-container-eb5ec8c7"><div class="gb-inside-container">
<div class="wp-block-columns is-layout-flex wp-container-core-columns-layout-6 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<div class="wp-block-columns is-layout-flex wp-container-core-columns-layout-5 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow" style="flex-basis:33.33%">
<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="600" height="600" src="https://tomassetti.me/wp-content/uploads/2021/05/ANTLR_Course_II.jpg" alt="Using ANTLR Like a Professional" class="wp-image-6738" srcset="https://tomassetti.me/wp-content/uploads/2021/05/ANTLR_Course_II.jpg 600w, https://tomassetti.me/wp-content/uploads/2021/05/ANTLR_Course_II-300x300.jpg 300w, https://tomassetti.me/wp-content/uploads/2021/05/ANTLR_Course_II-80x80.jpg 80w" sizes="(max-width: 600px) 100vw, 600px" /></figure>
</div>
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow" style="flex-basis:66.66%">
<p style="font-size:30px"><strong>Using ANTLR Like a Professional</strong></p>
<p>A complete video course on parsing and ANTLR, that will teach you how to build parser for everything from programming languages to data formats.</p>
<p><strong>Now, available as an improved II Edition.</strong></p>
</div>
</div>
<div class="wp-block-buttons is-content-justification-center is-layout-flex wp-container-core-buttons-layout-3 wp-block-buttons-is-layout-flex">
<div class="wp-block-button is-style-fill"><a class="wp-block-button__link" href="https://tomassetti.me/antlr-course-2-edition/" rel>Show Me the Course</a></div>
</div>
</div>
</div>
</div><div class="gb-shapes"><div class="gb-shape gb-shape-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 211.2" preserveAspectRatio="none"><path d="M600 188.4C321.1 188.4 84.3 109.5 0 0v211.2h1200V0c-84.3 109.5-321.1 188.4-600 188.4z" /></svg></div></div></div>
<p>We have learned a lot today:</p>
<ul><li>what a lexer and a parser are</li><li>how to create lexer and parser rules</li><li>how to use ANTLR to generate parsers in Java, C#, Python and JavaScript</li><li>the fundamental kinds of problems you will encounter parsing and how to solve them</li><li>how to understand errors</li><li>how to test your parsers</li></ul>
<p>That&#8217;s all you need to know to use ANTLR on your own. And I mean literally, you may want to know more, but now you have solid&nbsp;basis to explore on your own.</p>
<p>Where to look if you need more information about ANTLR:</p>
<ul><li>On this very website there is <a href="https://tomassetti.me/category/language-engineering/antlr/">whole category dedicated to ANTLR</a>.</li><li>The <a href="http://www.antlr.org/">official ANTLR website</a>&nbsp;is a good starting point to know the general status of the project, the specialized development tools and related project, like StringTemplate</li><li>The <a href="https://github.com/antlr/antlr4/tree/master/doc">ANTLR documentation on GitHub</a>; especially useful are the information on&nbsp;<a href="https://github.com/antlr/antlr4/blob/master/doc/targets.md">targets and how to setup it on different languages</a>.</li><li>The <a href="http://www.antlr.org/api/Java/index.html">ANTLR API</a>; it&#8217;s related to the Java version, so there might be some differences in other languages, but it&#8217;s the best place where to settle your doubts about the inner workings of this tool.</li><li>For the very interested in the&nbsp;science behind ANTLR4, there is an academic paper:&nbsp;<a href="http://www.antlr.org/papers/allstar-techreport.pdf"><em>Adaptive LL(*) Parsing: The Power of Dynamic Analysis</em></a></li><li><a href="https://pragprog.com/book/tpantlr2/the-definitive-antlr-4-reference"><strong>The Definitive ANTLR 4 Reference</strong></a>, by the man itself, <em>Terence Parr</em>, the creator of ANTLR. The resource you need if you want to know everything about ANTLR and a good deal about parsing languages in general.</li></ul>
<p>Also the book is only place where you can find and answer to question like these:</p>
<blockquote class="wp-block-quote"><p>ANTLR v4 is the result of a minor detour (twenty-five years) I took in graduate<br>
school. I guess Iâ€™m going to have to change my motto slightly.</p><p style="padding-left: 30px;"><em>Why program by hand in five days what you can spend twenty-five years of your</em><br>
<em>life automating?</em></p></blockquote>
<p>If instead you decide you could use some help with your projects involving ANTLR, you can also use our <a href="https://strumenta.com/antlr-consulting">ANTLR Consulting Services</a>.</p>
<p><em>We would like to thank Bernard Kaiflin for having revised the document and helped us improving it.</em></p>
<p><em>We would like to thank: Brasilio Castilho, Andy Nicholas, grz0, scinod for having spotted errors and typos in the article.</em></p>
<p><em>We worked quite hard to build the largest tutorial on ANTLR: the mega-tutorial! A post over 14.000 words long, or more than 70 pages, to try answering all your questions about ANTLR. Missing something? <a href="https://strumenta.com/contact-us/">Contact us</a> and let us now, we are here to help.</em></p>
</div>
</div>
</div>
</section>
<div class="margin-top-60">&nbsp;</div>
<div class="wp-block-strumenta-load-posts margin-top-30">
<div class="row full-width">
<div class="grid w5">
<div class="row full-width">
<div class="grid w12">
<section class="category-title">
<h2 class="desktop-hidden">Categories</h2>
</section>
</div>
</div>
<div class="category-description">
<ul class="category-list">
<li>
<a href="https://tomassetti.me/category/language-engineering/antlr/">ANTLR</a>
</li>
<li>
<a href="https://tomassetti.me/category/language-engineering/application-modernization/">Application modernization</a>
</li>
<li>
<a href="https://tomassetti.me/category/language-engineering/static-analysis/">Code processing</a>
</li>
<li>
<a href="https://tomassetti.me/category/consulting/">Consulting</a>
</li>
<li>
<a href="https://tomassetti.me/category/language-engineering/domain-specific-languages/">Domain specific languages</a>
</li>
<li>
<a href="https://tomassetti.me/category/language-engineering/editors/">Editors</a>
</li>
<li>
<a href="https://tomassetti.me/category/language-engineering/jetbrains-mps/">Jetbrains MPS</a>
</li>
<li>
<a href="https://tomassetti.me/category/language-engineering/language-design/">Language design</a>
</li>
<li>
<a href="https://tomassetti.me/category/language-engineering/">Language Engineering</a>
</li>
<li>
<a href="https://tomassetti.me/category/language-engineering/language-workbenches/">Language Workbenches</a>
</li>
<li>
<a href="https://tomassetti.me/category/miscellany/">Miscellany</a>
</li>
<li>
<a href="https://tomassetti.me/category/language-engineering/mdd/">Model driven development</a>
</li>
<li>
<a href="https://tomassetti.me/category/open-source/">Open-source</a>
</li>
<li>
<a href="https://tomassetti.me/category/language-engineering/parsing/">Parsing</a>
</li>
<li>
<a href="https://tomassetti.me/category/development/">Software Development</a>
</li>
</ul>
</div>
</div>
<div class="grid w7">
<div class="row full-width">
<div class="grid w12">
<section class="category-title">
<h2>More on ANTLR</h2>
</section>
</div>
</div>
<div class="row full-width">
<div class="grid w6">
<a class="post post_2" href="https://tomassetti.me/we-better-go-with-antlr-4-11/" data-post-id="7385">
<img width="1600" height="900" src="https://tomassetti.me/wp-content/uploads/2022/09/Template-Products-21.jpg" class="attachment-post-thumbnail size-post-thumbnail wp-post-image" alt decoding="async" loading="lazy" srcset="https://tomassetti.me/wp-content/uploads/2022/09/Template-Products-21.jpg 1600w, https://tomassetti.me/wp-content/uploads/2022/09/Template-Products-21-300x169.jpg 300w, https://tomassetti.me/wp-content/uploads/2022/09/Template-Products-21-1030x579.jpg 1030w, https://tomassetti.me/wp-content/uploads/2022/09/Template-Products-21-768x432.jpg 768w, https://tomassetti.me/wp-content/uploads/2022/09/Template-Products-21-1536x864.jpg 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /> <h3>We better Go with ANTLR 4.11</h3>
<p>14 September 2022</p>
</a>
</div>
<div class="grid w6">
<a class="post post_3" href="https://tomassetti.me/interview-with-kevin-mackey/" data-post-id="7338">
<img width="1600" height="900" src="https://tomassetti.me/wp-content/uploads/2022/06/Template-Products-14.jpg" class="attachment-post-thumbnail size-post-thumbnail wp-post-image" alt decoding="async" loading="lazy" srcset="https://tomassetti.me/wp-content/uploads/2022/06/Template-Products-14.jpg 1600w, https://tomassetti.me/wp-content/uploads/2022/06/Template-Products-14-300x169.jpg 300w, https://tomassetti.me/wp-content/uploads/2022/06/Template-Products-14-1030x579.jpg 1030w, https://tomassetti.me/wp-content/uploads/2022/06/Template-Products-14-768x432.jpg 768w, https://tomassetti.me/wp-content/uploads/2022/06/Template-Products-14-1536x864.jpg 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /> <h3>Interview with Kevin Mackey</h3>
<p>22 June 2022</p>
</a>
</div>
</div>
</div>
</div>
</div>
<footer>
<div class="row">
<div class="grid w12">
<section class="logo">
<img src="https://tomassetti.me/wp-content/themes/strumenta/imgs/logo.svg" alt>
<span class="name">
<strong>Strumenta</strong>
Tools to solve complex problems </span>
</section>
<section>
<div class="textwidget"><div class="container"><span class="copyright"><a href="https://strumenta.com/privacy-policy/">Privacy Policy</a><br/>
P.IVA 11817320010<br/>
<a href="https://strumenta.com/company-information">Company Information</a></span></div>
</div>
</section>
<section>
</section>
<section>
<div class="menu-socials-container"><ul id="menu-socials" class="menu"><li id="menu-item-6445" class="linkedin menu-item menu-item-type-custom menu-item-object-custom menu-item-6445"><a href="https://www.linkedin.com/company/strumenta/">Strumenta</a></li>
<li id="menu-item-6446" class="twitter menu-item menu-item-type-custom menu-item-object-custom menu-item-6446"><a href="https://twitter.com/strumenta">Strumenta</a></li>
<li id="menu-item-6447" class="linkedin menu-item menu-item-type-custom menu-item-object-custom menu-item-6447"><a href="https://www.linkedin.com/in/federicotomassetti/">Federico Tomassetti</a></li>
<li id="menu-item-6448" class="twitter menu-item menu-item-type-custom menu-item-object-custom menu-item-6448"><a href="https://twitter.com/ftomasse">Federico Tomassetti</a></li>
</ul></div> </section>
</div>
</div>
</footer>
<script type="rocketlazyloadscript" async data-uid="e5859b4f4c" src="https://strumenta-s-r-l.ck.page/e5859b4f4c/index.js"></script>
<style id="core-block-supports-inline-css" type="text/css">
.wp-container-core-columns-layout-1.wp-container-core-columns-layout-1{flex-wrap:nowrap;}.wp-container-core-buttons-layout-1.wp-container-core-buttons-layout-1{justify-content:center;}.wp-container-core-columns-layout-2.wp-container-core-columns-layout-2{flex-wrap:nowrap;}.wp-container-core-columns-layout-3.wp-container-core-columns-layout-3{flex-wrap:nowrap;}.wp-container-core-buttons-layout-2.wp-container-core-buttons-layout-2{justify-content:center;}.wp-container-core-columns-layout-4.wp-container-core-columns-layout-4{flex-wrap:nowrap;}.wp-container-core-columns-layout-5.wp-container-core-columns-layout-5{flex-wrap:nowrap;}.wp-container-core-buttons-layout-3.wp-container-core-buttons-layout-3{justify-content:center;}.wp-container-core-columns-layout-6.wp-container-core-columns-layout-6{flex-wrap:nowrap;}
</style>
<script type="text/javascript" id="convertkit-broadcasts-js-extra">
/* <![CDATA[ */
var convertkit_broadcasts = {"ajax_url":"https:\/\/tomassetti.me\/wp-admin\/admin-ajax.php","action":"convertkit_broadcasts_render","debug":""};
/* ]]> */
</script>
<script data-minify="1" type="text/javascript" src="https://tomassetti.me/wp-content/cache/min/1/wp-content/plugins/convertkit/resources/frontend/js/broadcasts.js?ver=1699350009" id="convertkit-broadcasts-js"></script>
<script type="text/javascript" id="convertkit-js-js-extra">
/* <![CDATA[ */
var convertkit = {"ajaxurl":"https:\/\/tomassetti.me\/wp-admin\/admin-ajax.php","debug":"","nonce":"a674bb7a40","subscriber_id":"","tag":"","post_id":"2989"};
/* ]]> */
</script>
<script data-minify="1" type="text/javascript" src="https://tomassetti.me/wp-content/cache/min/1/wp-content/plugins/convertkit/resources/frontend/js/convertkit.js?ver=1699350009" id="convertkit-js-js"></script>
<script type="text/javascript" id="rocket-browser-checker-js-after">
/* <![CDATA[ */
"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var RocketBrowserCompatibilityChecker=function(){function RocketBrowserCompatibilityChecker(options){_classCallCheck(this,RocketBrowserCompatibilityChecker),this.passiveSupported=!1,this._checkPassiveOption(this),this.options=!!this.passiveSupported&&options}return _createClass(RocketBrowserCompatibilityChecker,[{key:"_checkPassiveOption",value:function(self){try{var options={get passive(){return!(self.passiveSupported=!0)}};window.addEventListener("test",null,options),window.removeEventListener("test",null,options)}catch(err){self.passiveSupported=!1}}},{key:"initRequestIdleCallback",value:function(){!1 in window&&(window.requestIdleCallback=function(cb){var start=Date.now();return setTimeout(function(){cb({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-start))}})},1)}),!1 in window&&(window.cancelIdleCallback=function(id){return clearTimeout(id)})}},{key:"isDataSaverModeOn",value:function(){return"connection"in navigator&&!0===navigator.connection.saveData}},{key:"supportsLinkPrefetch",value:function(){var elem=document.createElement("link");return elem.relList&&elem.relList.supports&&elem.relList.supports("prefetch")&&window.IntersectionObserver&&"isIntersecting"in IntersectionObserverEntry.prototype}},{key:"isSlowConnection",value:function(){return"connection"in navigator&&"effectiveType"in navigator.connection&&("2g"===navigator.connection.effectiveType||"slow-2g"===navigator.connection.effectiveType)}}]),RocketBrowserCompatibilityChecker}();
/* ]]> */
</script>
<script type="text/javascript" id="rocket-preload-links-js-extra">
/* <![CDATA[ */
var RocketPreloadLinksConfig = {"excludeUris":"\/(?:.+\/)?feed(?:\/(?:.+\/?)?)?$\/|\/(?:.+\/)?embed\/|\/(index\\.php\/)?wp\\-json(\/.*|$)\/|\/refer\/|\/go\/|\/recommend\/|\/recommends\/","usesTrailingSlash":"1","imageExt":"jpg|jpeg|gif|png|tiff|bmp|webp|avif|pdf|doc|docx|xls|xlsx|php","fileExt":"jpg|jpeg|gif|png|tiff|bmp|webp|avif|pdf|doc|docx|xls|xlsx|php|html|htm","siteUrl":"https:\/\/tomassetti.me","onHoverDelay":"100","rateThrottle":"3"};
/* ]]> */
</script>
<script type="text/javascript" id="rocket-preload-links-js-after">
/* <![CDATA[ */
(function() {
"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=function(){function n(e,t){i(this,n),this.browser=e,this.config=t,this.options=this.browser.options,this.prefetched=new Set,this.eventTime=null,this.threshold=1111,this.numOnHover=0}return e(n,[{key:"init",value:function(){!this.browser.supportsLinkPrefetch()||this.browser.isDataSaverModeOn()||this.browser.isSlowConnection()||(this.regex={excludeUris:RegExp(this.config.excludeUris,"i"),images:RegExp(".("+this.config.imageExt+")$","i"),fileExt:RegExp(".("+this.config.fileExt+")$","i")},this._initListeners(this))}},{key:"_initListeners",value:function(e){-1<this.config.onHoverDelay&&document.addEventListener("mouseover",e.listener.bind(e),e.listenerOptions),document.addEventListener("mousedown",e.listener.bind(e),e.listenerOptions),document.addEventListener("touchstart",e.listener.bind(e),e.listenerOptions)}},{key:"listener",value:function(e){var t=e.target.closest("a"),n=this._prepareUrl(t);if(null!==n)switch(e.type){case"mousedown":case"touchstart":this._addPrefetchLink(n);break;case"mouseover":this._earlyPrefetch(t,n,"mouseout")}}},{key:"_earlyPrefetch",value:function(t,e,n){var i=this,r=setTimeout(function(){if(r=null,0===i.numOnHover)setTimeout(function(){return i.numOnHover=0},1e3);else if(i.numOnHover>i.config.rateThrottle)return;i.numOnHover++,i._addPrefetchLink(e)},this.config.onHoverDelay);t.addEventListener(n,function e(){t.removeEventListener(n,e,{passive:!0}),null!==r&&(clearTimeout(r),r=null)},{passive:!0})}},{key:"_addPrefetchLink",value:function(i){return this.prefetched.add(i.href),new Promise(function(e,t){var n=document.createElement("link");n.rel="prefetch",n.href=i.href,n.onload=e,n.onerror=t,document.head.appendChild(n)}).catch(function(){})}},{key:"_prepareUrl",value:function(e){if(null===e||"object"!==(void 0===e?"undefined":r(e))||!1 in e||-1===["http:","https:"].indexOf(e.protocol))return null;var t=e.href.substring(0,this.config.siteUrl.length),n=this._getPathname(e.href,t),i={original:e.href,protocol:e.protocol,origin:t,pathname:n,href:t+n};return this._isLinkOk(i)?i:null}},{key:"_getPathname",value:function(e,t){var n=t?e.substring(this.config.siteUrl.length):e;return n.startsWith("/")||(n="/"+n),this._shouldAddTrailingSlash(n)?n+"/":n}},{key:"_shouldAddTrailingSlash",value:function(e){return this.config.usesTrailingSlash&&!e.endsWith("/")&&!this.regex.fileExt.test(e)}},{key:"_isLinkOk",value:function(e){return null!==e&&"object"===(void 0===e?"undefined":r(e))&&(!this.prefetched.has(e.href)&&e.origin===this.config.siteUrl&&-1===e.href.indexOf("?")&&-1===e.href.indexOf("#")&&!this.regex.excludeUris.test(e.href)&&!this.regex.images.test(e.href))}}],[{key:"run",value:function(){"undefined"!=typeof RocketPreloadLinksConfig&&new n(new RocketBrowserCompatibilityChecker({capture:!0,passive:!0}),RocketPreloadLinksConfig).init()}}]),n}();t.run();
}());
/* ]]> */
</script>
<script data-minify="1" type="text/javascript" src="https://tomassetti.me/wp-content/cache/min/1/wp-content/themes/strumenta/js/functions.js?ver=1699350009" id="functions-js"></script>
<script type="text/javascript" src="https://tomassetti.me/wp-content/plugins/enlighter/cache/enlighterjs.min.js?ver=17z/oY1XLAuxLN2" id="enlighterjs-js"></script>
<script type="text/javascript" id="enlighterjs-js-after">
/* <![CDATA[ */
!function(e,n){if("undefined"!=typeof EnlighterJS){var o={"selectors":{"block":"pre.EnlighterJSRAW","inline":"code.EnlighterJSRAW"},"options":{"indent":2,"ampersandCleanup":true,"linehover":true,"rawcodeDbclick":false,"textOverflow":"break","linenumbers":true,"theme":"rowhammer","language":"generic","retainCssClasses":false,"collapse":false,"toolbarOuter":"","toolbarTop":"{BTN_RAW}{BTN_COPY}{BTN_WINDOW}{BTN_WEBSITE}","toolbarBottom":""}};(e.EnlighterJSINIT=function(){EnlighterJS.init(o.selectors.block,o.selectors.inline,o.options)})()}else{(n&&(n.error||n.log)||function(){})("Error: EnlighterJS resources not loaded yet!")}}(window,console);
/* ]]> */
</script>
<script type="text/javascript" src="https://stats.wp.com/e-202412.js" id="jetpack-stats-js" data-wp-strategy="defer"></script>
<script type="text/javascript" id="jetpack-stats-js-after">
/* <![CDATA[ */
_stq = window._stq || [];
_stq.push([ "view", JSON.parse("{\"v\":\"ext\",\"blog\":\"70090124\",\"post\":\"2989\",\"tz\":\"1\",\"srv\":\"tomassetti.me\",\"j\":\"1:13.1.3\"}") ]);
_stq.push([ "clickTrackerInit", "70090124", "2989" ]);
/* ]]> */
</script>
<script type="rocketlazyloadscript">
function aggiungiAttributiAnalytics() {
	ga('send', {
		hitType: 'event',
		eventCategory: 'Link',
		eventAction: 'click',
		eventLabel: this.textContent,
		dimension1: document.URL,
		dimension2: this.href,
		transport: 'beacon'
	});
}

function tracciaConversioneLinkedIn() {
	window.lintrk('track', { conversion_id: 5249761 });
}	
	
// aggiungi attributi ai link per tracciamento
for (var ls = document.getElementsByTagName("a"), numLinks = ls.length, i=0; i<numLinks; i++){    
        ls[i].addEventListener("click", aggiungiAttributiAnalytics, false);
	ls[i].addEventListener("auxclick", aggiungiAttributiAnalytics, false);
	ls[i].addEventListener("contextmenu", aggiungiAttributiAnalytics, false);
}

for (var lsb = document.getElementsByTagName("button"), numLinks = lsb.length, i=0; i<numLinks; i++){    
        lsb[i].addEventListener("click", aggiungiAttributiAnalytics, false);
	lsb[i].addEventListener("auxclick", aggiungiAttributiAnalytics, false);
	lsb[i].addEventListener("contextmenu", aggiungiAttributiAnalytics, false);
}
	
// LinkedIn Track Conversione
for (var lsb = document.getElementsByClassName("buy-button"), numLinks = lsb.length, i=0; i<numLinks; i++){    
     lsb[i].addEventListener("click", tracciaConversioneLinkedIn, false);	
}	
</script>

<script type="rocketlazyloadscript" data-rocket-type="text/javascript">
_linkedin_partner_id = "3582889";
window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || [];
window._linkedin_data_partner_ids.push(_linkedin_partner_id);
</script><script type="rocketlazyloadscript" data-rocket-type="text/javascript">
(function(l) {
if (!l){window.lintrk = function(a,b){window.lintrk.q.push([a,b])};
window.lintrk.q=[]}
var s = document.getElementsByTagName("script")[0];
var b = document.createElement("script");
b.type = "text/javascript";b.async = true;
b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js";
s.parentNode.insertBefore(b, s);})(window.lintrk);
</script>
<noscript>
<img height="1" width="1" style="display:none;" alt="" src="https://px.ads.linkedin.com/collect/?pid=3582889&fmt=gif" />
</noscript>
</body></html>
